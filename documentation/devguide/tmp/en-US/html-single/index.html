<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Hibernate Development Guide</title><link rel="stylesheet" href="Common_Content/css/default.css" type="text/css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 2.5" /><meta name="package" content="Documentation-Hibernate_Development_Guide-0.1-en-US-0-0" /><meta name="description" content="A short overview and summary of the book's subject and purpose, traditionally no more than one paragraph long. Note: the abstract will appear in the front matter of your book and will also be placed in the description field of the book's RPM spec file." /></head><body><p id="title"><a class="left" href="http://www.hibernate.org/"><img src="Common_Content/images/image_left.png" alt="Product Site" /></a><a class="right" href="http://hibernate.org/Documentation/DocumentationOverview"><img src="Common_Content/images/image_right.png" alt="Documentation Site" /></a></p><div xml:lang="en-US" class="book" id="id554569" lang="en-US"><div class="titlepage"><div><div class="producttitle"><span class="productname">Documentation</span> <span class="productnumber">0.1</span></div><div><h1 id="id554569" class="title">Hibernate Development Guide</h1></div><div><h2 class="subtitle">short description</h2></div><p class="edition">Edition 0</p><div><h3 class="corpauthor">
		<span class="inlinemediaobject"><object data="Common_Content/images/title_logo.svg" type="image/svg+xml"> </object></span>

	</h3></div><div><div xml:lang="en-US" class="authorgroup" lang="en-US"><div class="author"><h3 class="author"><span class="firstname">Misty</span> <span class="surname">Stanley-Jones</span></h3><div class="affiliation"><span class="orgname">Red Hat</span></div><code class="email"><a class="email" href="mailto:misty@redhat.com">misty@redhat.com</a></code></div><div class="author"><h3 class="author"><span class="firstname">Steve</span> <span class="surname">Ebersole</span></h3><div class="affiliation"><span class="orgname">Red Hat</span></div><code class="email"><a class="email" href="mailto:sebersol@redhat.com">sebersol@redhat.com</a></code></div></div></div><hr /><div><div id="id679998" class="legalnotice"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"></span>© 2011 Red Hat.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, JBoss, MetaMatrix, Fedora, the Infinity Logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div><div><div class="abstract"><h6>Abstract</h6><div class="para">
			A short overview and summary of the book's subject and purpose, traditionally no more than one paragraph long. Note: the abstract will appear in the front matter of your book and will also be placed in the description field of the book's RPM spec file.
		</div></div></div></div><hr /></div><div class="toc"><dl><dt><span class="preface"><a href="#pref-Hibernate_Development_Guide-Preface">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#id711572">1. Document Conventions</a></span></dt><dd><dl><dt><span class="section"><a href="#id703389">1.1. Typographic Conventions</a></span></dt><dt><span class="section"><a href="#id616673">1.2. Pull-quote Conventions</a></span></dt><dt><span class="section"><a href="#id617728">1.3. Notes and Warnings</a></span></dt></dl></dd><dt><span class="section"><a href="#id608557">2. We Need Feedback!</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id555081">1. Database access</a></span></dt><dd><dl><dt><span class="section"><a href="#id694340">1.1. Connection</a></span></dt><dd><dl><dt><span class="section"><a href="#id657749">1.1.1. Configuring database connections</a></span></dt><dt><span class="section"><a href="#id636020">1.1.2. Obtaining a JDBC connection</a></span></dt></dl></dd><dt><span class="section"><a href="#id636112">1.2. Connection pooling</a></span></dt><dd><dl><dt><span class="section"><a href="#id636129">1.2.1. c3p0 connection pool</a></span></dt><dt><span class="section"><a href="#id552699">1.2.2. Proxool connection pool</a></span></dt><dt><span class="section"><a href="#id677379">1.2.3. Obtaining connections from an application server, using JNDI</a></span></dt><dt><span class="section"><a href="#id677447">1.2.4. Other connection-specific configuration</a></span></dt><dt><span class="section"><a href="#id677478">1.2.5. Optional configuration properties</a></span></dt></dl></dd><dt><span class="section"><a href="#configuring-dialects">1.3. Dialects</a></span></dt><dt><span class="section"><a href="#id597392">1.4. Automatic schema generation with SchemaExport</a></span></dt><dd><dl><dt><span class="section"><a href="#id597425">1.4.1. Customizing the mapping files</a></span></dt><dt><span class="section"><a href="#id666486">1.4.2. Running the SchemaExport tool</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id555174">2. Transactions and concurrency control</a></span></dt><dd><dl><dt><span class="section"><a href="#id668100">2.1. Defining a transaction</a></span></dt><dt><span class="section"><a href="#id684108">2.2. How Hibernate uses transactions</a></span></dt><dt><span class="section"><a href="#id626099">2.3. Transaction Scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#session-per-operation">2.3.1. Session-per-operation</a></span></dt><dt><span class="section"><a href="#id628065">2.3.2. Session-per-request</a></span></dt><dt><span class="section"><a href="#long-conversations">2.3.3. Conversations</a></span></dt><dt><span class="section"><a href="#id700984">2.3.4. Object identity</a></span></dt><dt><span class="section"><a href="#transaction-antipatterns">2.3.5. Problems and antipatterns</a></span></dt></dl></dd><dt><span class="section"><a href="#id676832">2.4. Types</a></span></dt><dt><span class="section"><a href="#hibernate-transaction-api">2.5. Hibernate Transaction API (JTA)</a></span></dt><dd><dl><dt><span class="section"><a href="#id676858">2.5.1. Bean-managed transactions (BMT)</a></span></dt><dt><span class="section"><a href="#id676931">2.5.2. Container-managed transactions (CMT)</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id703804">3. Batch Processing</a></span></dt><dd><dl><dt><span class="section"><a href="#id555276">3.1. Batch inserts</a></span></dt><dt><span class="section"><a href="#id674521">3.2. Batch updates</a></span></dt><dt><span class="section"><a href="#id668971">3.3. StatelessSession</a></span></dt><dt><span class="section"><a href="#id676168">3.4. Hibernate Query Language for DML</a></span></dt><dd><dl><dt><span class="section"><a href="#id676198">3.4.1. HQL for UPDATE and DELETE</a></span></dt><dt><span class="section"><a href="#id593574">3.4.2. HQL syntax for INSERT</a></span></dt><dt><span class="section"><a href="#id606598">3.4.3. More information on HQL</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id629656">4. Locking</a></span></dt><dd><dl><dt><span class="section"><a href="#id722588">4.1. Optimistic</a></span></dt><dd><dl><dt><span class="section"><a href="#id677814">4.1.1. Dedicated version number</a></span></dt><dt><span class="section"><a href="#id618854">4.1.2. Timestamp</a></span></dt></dl></dd><dt><span class="section"><a href="#id630238">4.2. Pessimistic</a></span></dt><dd><dl><dt><span class="section"><a href="#id630258">4.2.1. The <code class="classname">LockMode</code> class</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id597010">5. Caching</a></span></dt><dd><dl><dt><span class="section"><a href="#id626068">5.1. The query cache</a></span></dt><dd><dl><dt><span class="section"><a href="#id625680">5.1.1. Query cache regions</a></span></dt></dl></dd><dt><span class="section"><a href="#id674763">5.2. Second-level cache providers</a></span></dt><dd><dl><dt><span class="section"><a href="#id674784">5.2.1. Configuring your cache providers</a></span></dt><dt><span class="section"><a href="#caching-strategies-list">5.2.2. Caching strategies</a></span></dt><dt><span class="section"><a href="#caching-provider-table">5.2.3. Second-level cache providers for Hibernate</a></span></dt></dl></dd><dt><span class="section"><a href="#id616840">5.3. Managing the cache</a></span></dt><dd><dl><dt><span class="section"><a href="#id616847">5.3.1. Moving items into and out of the cache</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id674235">6. Data categorizations</a></span></dt><dd><dl><dt><span class="section"><a href="#value-types">6.1. Value types</a></span></dt><dd><dl><dt><span class="section"><a href="#value-basic-types">6.1.1. Basic types</a></span></dt><dt><span class="section"><a href="#value-composite-types">6.1.2. Composite types</a></span></dt><dt><span class="section"><a href="#value-collection-types">6.1.3. Collection types</a></span></dt></dl></dd><dt><span class="section"><a href="#entity-types">6.2. Entity Types</a></span></dt><dt><span class="section"><a href="#id606315">6.3. Implications of different data categorizations</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id555220">7. Mapping entities</a></span></dt><dd><dl><dt><span class="section"><a href="#id670714">7.1. Hierarchies</a></span></dt></dl></dd><dt><span class="chapter"><a href="#id702195">8. Mapping associations</a></span></dt><dt><span class="chapter"><a href="#chap-hql">9. HQL and JPAQL</a></span></dt><dt><span class="chapter"><a href="#id698504">10. Criteria</a></span></dt><dt><span class="chapter"><a href="#id658424">11. Native-SQL</a></span></dt><dt><span class="chapter"><a href="#id698643">12. JMX</a></span></dt><dt><span class="appendix"><a href="#appendix-Configuration_Properties">A. Configuration properties</a></span></dt><dd><dl><dt><span class="section"><a href="#id702970">A.1. General Configuration</a></span></dt><dt><span class="section"><a href="#id697542">A.2. Database configuration</a></span></dt><dt><span class="section"><a href="#id624351">A.3. Connection pool properties</a></span></dt></dl></dd><dt><span class="appendix"><a href="#appe-Hibernate_Development_Guide-Revision_History">B. Revision History</a></span></dt><dt><span class="index"><a href="#id548714">Index</a></span></dt></dl></div><div xml:lang="en-US" class="preface" id="pref-Hibernate_Development_Guide-Preface" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><div xml:lang="en-US" class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="id711572">1. Document Conventions</h2></div></div></div><div class="para">
		This manual uses several conventions to highlight certain words and phrases and draw attention to specific pieces of information.
	</div><div class="para">
		In PDF and paper editions, this manual uses typefaces drawn from the <a href="https://fedorahosted.org/liberation-fonts/">Liberation Fonts</a> set. The Liberation Fonts set is also used in HTML editions if the set is installed on your system. If not, alternative but equivalent typefaces are displayed. Note: Red Hat Enterprise Linux 5 and later includes the Liberation Fonts set by default.
	</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id703389">1.1. Typographic Conventions</h3></div></div></div><div class="para">
			Four typographic conventions are used to call attention to specific words and phrases. These conventions, and the circumstances they apply to, are as follows.
		</div><div class="para">
			<code class="literal">Mono-spaced Bold</code>
		</div><div class="para">
			Used to highlight system input, including shell commands, file names and paths. Also used to highlight keycaps and key combinations. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				To see the contents of the file <code class="filename">my_next_bestselling_novel</code> in your current working directory, enter the <code class="command">cat my_next_bestselling_novel</code> command at the shell prompt and press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</div></blockquote></div><div class="para">
			The above includes a file name, a shell command and a keycap, all presented in mono-spaced bold and all distinguishable thanks to context.
		</div><div class="para">
			Key combinations can be distinguished from keycaps by the hyphen connecting each part of a key combination. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				Press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</div><div class="para">
				Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F2</strong></span> to switch to the first virtual terminal. Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> to return to your X-Windows session.
			</div></blockquote></div><div class="para">
			The first paragraph highlights the particular keycap to press. The second highlights two key combinations (each a set of three keycaps with each set pressed simultaneously).
		</div><div class="para">
			If source code is discussed, class names, methods, functions, variable names and returned values mentioned within a paragraph will be presented as above, in <code class="literal">mono-spaced bold</code>. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				File-related classes include <code class="classname">filesystem</code> for file systems, <code class="classname">file</code> for files, and <code class="classname">dir</code> for directories. Each class has its own associated set of permissions.
			</div></blockquote></div><div class="para">
			<span class="application"><strong>Proportional Bold</strong></span>
		</div><div class="para">
			This denotes words or phrases encountered on a system, including application names; dialog box text; labeled buttons; check-box and radio button labels; menu titles and sub-menu titles. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				Choose <span class="guimenu"><strong>System</strong></span> → <span class="guisubmenu"><strong>Preferences</strong></span> → <span class="guimenuitem"><strong>Mouse</strong></span> from the main menu bar to launch <span class="application"><strong>Mouse Preferences</strong></span>. In the <span class="guilabel"><strong>Buttons</strong></span> tab, click the <span class="guilabel"><strong>Left-handed mouse</strong></span> check box and click <span class="guibutton"><strong>Close</strong></span> to switch the primary mouse button from the left to the right (making the mouse suitable for use in the left hand).
			</div><div class="para">
				To insert a special character into a <span class="application"><strong>gedit</strong></span> file, choose <span class="guimenu"><strong>Applications</strong></span> → <span class="guisubmenu"><strong>Accessories</strong></span> → <span class="guimenuitem"><strong>Character Map</strong></span> from the main menu bar. Next, choose <span class="guimenu"><strong>Search</strong></span> → <span class="guimenuitem"><strong>Find…</strong></span> from the <span class="application"><strong>Character Map</strong></span> menu bar, type the name of the character in the <span class="guilabel"><strong>Search</strong></span> field and click <span class="guibutton"><strong>Next</strong></span>. The character you sought will be highlighted in the <span class="guilabel"><strong>Character Table</strong></span>. Double-click this highlighted character to place it in the <span class="guilabel"><strong>Text to copy</strong></span> field and then click the <span class="guibutton"><strong>Copy</strong></span> button. Now switch back to your document and choose <span class="guimenu"><strong>Edit</strong></span> → <span class="guimenuitem"><strong>Paste</strong></span> from the <span class="application"><strong>gedit</strong></span> menu bar.
			</div></blockquote></div><div class="para">
			The above text includes application names; system-wide menu names and items; application-specific menu names; and buttons and text found within a GUI interface, all presented in proportional bold and all distinguishable by context.
		</div><div class="para">
			<code class="command"><em class="replaceable"><code>Mono-spaced Bold Italic</code></em></code> or <span class="application"><strong><em class="replaceable"><code>Proportional Bold Italic</code></em></strong></span>
		</div><div class="para">
			Whether mono-spaced bold or proportional bold, the addition of italics indicates replaceable or variable text. Italics denotes text you do not input literally or displayed text that changes depending on circumstance. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				To connect to a remote machine using ssh, type <code class="command">ssh <em class="replaceable"><code>username</code></em>@<em class="replaceable"><code>domain.name</code></em></code> at a shell prompt. If the remote machine is <code class="filename">example.com</code> and your username on that machine is john, type <code class="command">ssh john@example.com</code>.
			</div><div class="para">
				The <code class="command">mount -o remount <em class="replaceable"><code>file-system</code></em></code> command remounts the named file system. For example, to remount the <code class="filename">/home</code> file system, the command is <code class="command">mount -o remount /home</code>.
			</div><div class="para">
				To see the version of a currently installed package, use the <code class="command">rpm -q <em class="replaceable"><code>package</code></em></code> command. It will return a result as follows: <code class="command"><em class="replaceable"><code>package-version-release</code></em></code>.
			</div></blockquote></div><div class="para">
			Note the words in bold italics above — username, domain.name, file-system, package, version and release. Each word is a placeholder, either for text you enter when issuing a command or for text displayed by the system.
		</div><div class="para">
			Aside from standard usage for presenting the title of a work, italics denotes the first use of a new and important term. For example:
		</div><div class="blockquote"><blockquote class="blockquote"><div class="para">
				Publican is a <em class="firstterm">DocBook</em> publishing system.
			</div></blockquote></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id616673">1.2. Pull-quote Conventions</h3></div></div></div><div class="para">
			Terminal output and source code listings are set off visually from the surrounding text.
		</div><div class="para">
			Output sent to a terminal is set in <code class="computeroutput">mono-spaced roman</code> and presented thus:
		</div><pre class="screen">books        Desktop   documentation  drafts  mss    photos   stuff  svn
books_tests  Desktop1  downloads      images  notes  scripts  svgs</pre><div class="para">
			Source-code listings are also set in <code class="computeroutput">mono-spaced roman</code> but add syntax highlighting as follows:
		</div><pre class="programlisting">package org.<span class="perl_Function">jboss</span>.<span class="perl_Function">book</span>.<span class="perl_Function">jca</span>.<span class="perl_Function">ex1</span>;

<span class="perl_Keyword">import</span> javax.naming.InitialContext;

<span class="perl_Keyword">public</span> <span class="perl_Keyword">class</span> ExClient
{
   <span class="perl_Keyword">public</span> <span class="perl_DataType">static</span> <span class="perl_DataType">void</span> <span class="perl_Function">main</span>(String args[]) 
       <span class="perl_Keyword">throws</span> Exception
   {
      InitialContext iniCtx = <span class="perl_Keyword">new</span> InitialContext();
      Object         ref    = iniCtx.<span class="perl_Function">lookup</span>(<span class="perl_String">"EchoBean"</span>);
      EchoHome       home   = (EchoHome) ref;
      Echo           echo   = home.<span class="perl_Function">create</span>();

      System.<span class="perl_Function">out</span>.<span class="perl_Function">println</span>(<span class="perl_String">"Created Echo"</span>);

      System.<span class="perl_Function">out</span>.<span class="perl_Function">println</span>(<span class="perl_String">"Echo.echo('Hello') = "</span> + echo.<span class="perl_Function">echo</span>(<span class="perl_String">"Hello"</span>));
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id617728">1.3. Notes and Warnings</h3></div></div></div><div class="para">
			Finally, we use three visual styles to draw attention to information that might otherwise be overlooked.
		</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				Notes are tips, shortcuts or alternative approaches to the task at hand. Ignoring a note should have no negative consequences, but you might miss out on a trick that makes your life easier.
			</div></div></div><div class="important"><div class="admonition_header"><h2>Important</h2></div><div class="admonition"><div class="para">
				Important boxes detail things that are easily missed: configuration changes that only apply to the current session, or services that need restarting before an update will apply. Ignoring a box labeled 'Important' will not cause data loss but may cause irritation and frustration.
			</div></div></div><div class="warning"><div class="admonition_header"><h2>Warning</h2></div><div class="admonition"><div class="para">
				Warnings should not be ignored. Ignoring warnings will most likely cause data loss.
			</div></div></div></div></div><div xml:lang="en-US" class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title" id="id608557">2. We Need Feedback!</h2></div></div></div><a id="id608567" class="indexterm"></a><div class="para">
		If you find a typographical error in this manual, or if you have thought of a way to make this manual better, we would love to hear from you! Please submit a report in the Hibernate Issue Tracker: <a href="http://opensource.atlassian.com/projects/hibernate/secure/Dashboard.jspa">http://opensource.atlassian.com/projects/hibernate/secure/Dashboard.jspa</a> against the product <span class="application"><strong>Hibernate.</strong></span>
	</div><div class="para">
		When submitting a bug report, be sure to mention the manual's identifier: <em class="citetitle">Hibernate_Development_Guide</em>
	</div><div class="para">
		If you have a suggestion for improving the documentation, try to be as specific as possible when describing it. If you have found an error, please include the section number and some of the surrounding text so we can find it easily.
	</div></div></div><div xml:lang="en-US" class="chapter" id="id555081" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 1. Database access</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#id694340">1.1. Connection</a></span></dt><dd><dl><dt><span class="section"><a href="#id657749">1.1.1. Configuring database connections</a></span></dt><dt><span class="section"><a href="#id636020">1.1.2. Obtaining a JDBC connection</a></span></dt></dl></dd><dt><span class="section"><a href="#id636112">1.2. Connection pooling</a></span></dt><dd><dl><dt><span class="section"><a href="#id636129">1.2.1. c3p0 connection pool</a></span></dt><dt><span class="section"><a href="#id552699">1.2.2. Proxool connection pool</a></span></dt><dt><span class="section"><a href="#id677379">1.2.3. Obtaining connections from an application server, using JNDI</a></span></dt><dt><span class="section"><a href="#id677447">1.2.4. Other connection-specific configuration</a></span></dt><dt><span class="section"><a href="#id677478">1.2.5. Optional configuration properties</a></span></dt></dl></dd><dt><span class="section"><a href="#configuring-dialects">1.3. Dialects</a></span></dt><dt><span class="section"><a href="#id597392">1.4. Automatic schema generation with SchemaExport</a></span></dt><dd><dl><dt><span class="section"><a href="#id597425">1.4.1. Customizing the mapping files</a></span></dt><dt><span class="section"><a href="#id666486">1.4.2. Running the SchemaExport tool</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id694340">1.1. Connection</h2></div></div></div><div class="para">
			Hibernate connects to databases on behalf of your applications. It can connect through a variety of different machanisms, including:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Stand-alone built-in connection pool
				</div></li><li class="listitem"><div class="para">
					<code class="classname">javax.sql.DataSource</code>
				</div></li><li class="listitem"><div class="para">
					Two different third-party opensource JDBC connection pools:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							c3p0
						</div></li><li class="listitem"><div class="para">
							proxool
						</div></li></ul></div></li></ul></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				The built-in connection pool is not intended for production environments.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id657749">1.1.1. Configuring database connections</h3></div></div></div><div class="para">
				You can configure database connections using a properties file, an XML deployment descriptor, programmatically.
			</div><div class="example"><h6>Example 1.1. <code class="filename">hibernate.properties</code> for a c3p0 connection pool</h6><div class="example-contents"><pre class="programlisting">hibernate.connection.driver_class = org.postgresql.Driver
hibernate.connection.url = jdbc:postgresql://localhost/mydatabase
hibernate.connection.username = myuser
hibernate.connection.password = secret
hibernate.c3p0.min_size=5
hibernate.c3p0.max_size=20
hibernate.c3p0.timeout=1800
hibernate.c3p0.max_statements=50
hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect</pre></div></div><br class="example-break" /><div class="example"><h6>Example 1.2. <code class="filename">hibernate.cfg.xml</code> for a connection to the bundled HSQL database</h6><div class="example-contents"><pre class="programlisting XML"><span class="perl_Keyword">&lt;?xml</span> version='1.0' encoding='utf-8'<span class="perl_Keyword">?&gt;</span>
<span class="perl_DataType">&lt;!DOCTYPE </span>hibernate-configuration PUBLIC
"-//Hibernate/Hibernate Configuration DTD 3.0//EN"
"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"<span class="perl_DataType">&gt;</span>

<span class="perl_Keyword">&lt;hibernate-configuration&gt;</span>
  <span class="perl_Keyword">&lt;session-factory&gt;</span>
    <span class="perl_Comment">&lt;!-- Database connection settings --&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"connection.driver_class"</span><span class="perl_Keyword">&gt;</span>org.hsqldb.jdbcDriver<span class="perl_Keyword">&lt;/property&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"connection.url"</span><span class="perl_Keyword">&gt;</span>jdbc:hsqldb:hsql://localhost<span class="perl_Keyword">&lt;/property&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"connection.username"</span><span class="perl_Keyword">&gt;</span>sa<span class="perl_Keyword">&lt;/property&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"connection.password"</span><span class="perl_Keyword">&gt;&lt;/property&gt;</span>

    <span class="perl_Comment">&lt;!-- JDBC connection pool (use the built-in) --&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"connection.pool_size"</span><span class="perl_Keyword">&gt;</span>1<span class="perl_Keyword">&lt;/property&gt;</span>

    <span class="perl_Comment">&lt;!-- SQL dialect --&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"dialect"</span><span class="perl_Keyword">&gt;</span>org.hibernate.dialect.HSQLDialect<span class="perl_Keyword">&lt;/property&gt;</span>

    <span class="perl_Comment">&lt;!-- Enable Hibernate's automatic session context management --&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"current_session_context_class"</span><span class="perl_Keyword">&gt;</span>thread<span class="perl_Keyword">&lt;/property&gt;</span>

    <span class="perl_Comment">&lt;!-- Disable the second-level cache  --&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"cache.provider_class"</span><span class="perl_Keyword">&gt;</span>org.hibernate.cache.NoCacheProvider<span class="perl_Keyword">&lt;/property&gt;</span>

    <span class="perl_Comment">&lt;!-- Echo all executed SQL to stdout --&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"show_sql"</span><span class="perl_Keyword">&gt;</span>true<span class="perl_Keyword">&lt;/property&gt;</span>

    <span class="perl_Comment">&lt;!-- Drop and re-create the database schema on startup --&gt;</span>
    <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"hbm2ddl.auto"</span><span class="perl_Keyword">&gt;</span>update<span class="perl_Keyword">&lt;/property&gt;</span>
    <span class="perl_Keyword">&lt;mapping</span><span class="perl_Others"> resource=</span><span class="perl_String">"org/hibernate/tutorial/domain/Event.hbm.xml"</span><span class="perl_Keyword">/&gt;</span>
  <span class="perl_Keyword">&lt;/session-factory&gt;</span>
<span class="perl_Keyword">&lt;/hibernate-configuration&gt;</span>
</pre></div></div><br class="example-break" /><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					The DTD in the configuration file used in this example is required.
				</div></div></div><div class="warning"><div class="admonition_header"><h2>Warning</h2></div><div class="admonition"><div class="para">
					Do not use the HSQL database for production.
				</div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="id257302">1.1.1.1. Programatic configuration</h4></div></div></div><div class="para">
					An instance of object <code class="classname">org.hibernate.cfg.Configuration</code> represents an entire set of mappings of an application's Java types to an SQL database. The <code class="classname">org.hibernate.cfg.Configuration</code> builds an immutable <code class="classname">org.hibernate.SessionFactory</code>, and compiles the mappings from various XML mapping files. You can specify the mapping files directly, or Hibernate can find them for you.
				</div><div class="example"><h6>Example 1.3. Specifying the mapping files directly</h6><div class="example-contents"><div class="para">
						You can obtain a <code class="classname">org.hibernate.cfg.Configuration</code> instance by instantiating it directly and specifying XML mapping documents. If the mapping files are in the classpath, use method <code class="methodname">addResource()</code>.
					</div><pre class="programlisting JAVA">Configuration cfg = <span class="perl_Keyword">new</span> Configuration()
    .<span class="perl_Function">addResource</span>(<span class="perl_String">"Item.hbm.xml"</span>)
    .<span class="perl_Function">addResource</span>(<span class="perl_String">"Bid.hbm.xml"</span>);</pre></div></div><br class="example-break" /><div class="example"><h6>Example 1.4. Letting Hibernate find the mapping files for you</h6><div class="example-contents"><div class="para">
						The <code class="methodname">addConfig()</code> method directs Hibernate to search the CLASSPATH for the mapping files, eliminating hard-coded file names. In the following example, it searches for <code class="filename">org/hibernate/auction/Item.hbm.xml</code> and <code class="filename">org/hibernate/auction/Bid.hbm.xml</code>.
					</div><pre class="programlisting JAVA">Configuration cfg = <span class="perl_Keyword">new</span> Configuration()
    .<span class="perl_Function">addClass</span>(org.<span class="perl_Function">hibernate</span>.<span class="perl_Function">auction</span>.<span class="perl_Function">Item</span>.<span class="perl_Function">class</span>)
    .<span class="perl_Function">addClass</span>(org.<span class="perl_Function">hibernate</span>.<span class="perl_Function">auction</span>.<span class="perl_Function">Bid</span>.<span class="perl_Function">class</span>);</pre></div></div><br class="example-break" /><div class="example"><h6>Example 1.5. Specifying configuration properties</h6><div class="example-contents"><pre class="programlisting JAVA">Configuration cfg = <span class="perl_Keyword">new</span> Configuration()
    .<span class="perl_Function">addClass</span>(org.<span class="perl_Function">hibernate</span>.<span class="perl_Function">auction</span>.<span class="perl_Function">Item</span>.<span class="perl_Function">class</span>)
    .<span class="perl_Function">addClass</span>(org.<span class="perl_Function">hibernate</span>.<span class="perl_Function">auction</span>.<span class="perl_Function">Bid</span>.<span class="perl_Function">class</span>)
    .<span class="perl_Function">setProperty</span>(<span class="perl_String">"hibernate.dialect"</span>, <span class="perl_String">"org.hibernate.dialect.MySQLInnoDBDialect"</span>)
    .<span class="perl_Function">setProperty</span>(<span class="perl_String">"hibernate.connection.datasource"</span>, <span class="perl_String">"java:comp/env/jdbc/test"</span>)
    .<span class="perl_Function">setProperty</span>(<span class="perl_String">"hibernate.order_updates"</span>, <span class="perl_String">"true"</span>);</pre></div></div><br class="example-break" /><div class="itemizedlist"><h6>Other ways to configure Hibernate programmatically</h6><ul><li class="listitem"><div class="para">
							Pass an instance of <code class="classname">java.util.Properties</code> to <code class="classname">Configuration.setProperties()</code>.
						</div></li><li class="listitem"><div class="para">
							Set System properties using <code class="command">java -D<em class="replaceable"><code>property</code></em>=<em class="replaceable"><code>value</code></em></code>
						</div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id636020">1.1.2. Obtaining a JDBC connection</h3></div></div></div><div class="para">
				After you configure the <a class="xref" href="#hibernate-jdbc-properties">Most important Hibernate JDBC properties</a>, you can use method <code class="methodname">openSession</code> of class <code class="classname">org.hibernate.SessionFactory</code> to open sessions. 
<pre class="programlisting JAVA">Session session = sessions.<span class="perl_Function">openSession</span>();</pre>

			</div><div class="itemizedlist" id="hibernate-jdbc-properties"><h6>Most important Hibernate JDBC properties</h6><ul><li class="listitem"><div class="para">
						hibernate.connection.driver_class
					</div></li><li class="listitem"><div class="para">
						hibernate.connection.url
					</div></li><li class="listitem"><div class="para">
						hibernate.connection.username
					</div></li><li class="listitem"><div class="para">
						hibernate.connection.password
					</div></li><li class="listitem"><div class="para">
						hibernate.connection.pool_size
					</div></li></ul></div><div class="para">
				All Hibernate property names and semantics are defined in class <code class="classname">org.hibernate.cfg.Environment</code>. See the Javadoc for a complete listing.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id636112">1.2. Connection pooling</h2></div></div></div><div class="para">
			Hibernate's internal connection pooling algorithm is rudimentary, and is provided for development and testing purposes. Use a third-party pool for best performance and stability. To use a third-party pool, replace the <span class="property">hibernate.connection.pool_size property</span> with settings specific to your connection pool of choice. This disables Hibernate's internal connection pool.
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id636129">1.2.1. c3p0 connection pool</h3></div></div></div><div class="para">
				C3P0 is an open source JDBC connection pool distributed along with Hibernate in the <code class="filename">lib/</code> directory. Hibernate uses its <code class="classname">org.hibernate.connection.C3P0ConnectionProvider</code> for connection pooling if you set the <span class="property">hibernate.c3p0.*</span> properties. properties.
			</div><div class="itemizedlist"><h6>Important configuration properties for the c3p0 connection pool</h6><ul><li class="listitem"><div class="para">
						hibernate.c3p0.min_size
					</div></li><li class="listitem"><div class="para">
						hibernate.c3p0.max_size
					</div></li><li class="listitem"><div class="para">
						hibernate.c3p0.timeout
					</div></li><li class="listitem"><div class="para">
						hibernate.c3p0.max_statements
					</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id552699">1.2.2. Proxool connection pool</h3></div></div></div><div class="para">
				Proxool is another open source JDBC connection pool distributed along with Hibernate in the <code class="filename">lib/</code> directory. Hibernate uses its <code class="classname">org.hibernate.connection.ProxoolConnectionProvider</code> for connection pooling if you set the <span class="property">hibernate.proxool.*</span> properties. Unlike c3p0, proxool requires some additional configuration parameters, as described by the Proxool documentation available at <a href="http://proxool.sourceforge.net/configure.html">http://proxool.sourceforge.net/configure.html</a>.
			</div><div class="table"><h6>Table 1.1. Important configuration properties for the Proxool connection pool</h6><div class="table-contents"><table summary="Important configuration properties for the Proxool connection pool" border="1"><colgroup><col width="120px" /><col width="320px" /></colgroup><thead><tr><th>
								Property
							</th><th>
								Description
							</th></tr></thead><tbody><tr><td>
								hibernate.proxool.xml
							</td><td>
								Configure Proxool provider using an XML file (.xml is appended automatically)
							</td></tr><tr><td>
								hibernate.proxool.properties
							</td><td>
								Configure the Proxool provider using a properties file (.properties is appended automatically)
							</td></tr><tr><td>
								hibernate.proxool.existing_pool
							</td><td>
								Whether to configure the Proxool provider from an existing pool
							</td></tr><tr><td>
								hibernate.proxool.pool_alias
							</td><td>
								Proxool pool alias to use. Required.
							</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id677379">1.2.3. Obtaining connections from an application server, using JNDI</h3></div></div></div><div class="para">
				To use Hibernate inside an application server, configure Hibernate to obtain connections from an application server <code class="classname">javax.sql.Datasource</code> registered in JNDI, by setting at least one of the following properties:
			</div><div class="itemizedlist"><h6>Important Hibernate properties for JNDI datasources</h6><ul><li class="listitem"><div class="para">
						hibernate.connection.datasource (required)
					</div></li><li class="listitem"><div class="para">
						hibernate.jndi.url
					</div></li><li class="listitem"><div class="para">
						hibernate.jndi.class
					</div></li><li class="listitem"><div class="para">
						hibernate.connection.username
					</div></li><li class="listitem"><div class="para">
						hibernate.connection.password
					</div></li></ul></div><div class="para">
				JDBC connections obtained from a JNDI datasource automatically participate in the container-managed transactions of the application server.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id677447">1.2.4. Other connection-specific configuration</h3></div></div></div><div class="para">
				You can pass arbitrary connection properties by prepending <code class="literal">hibernate.connection</code> to the connection property name. For example, specify a charSet connection property as <span class="property">hibernate.connection.charSet</span>.
			</div><div class="para">
				You can define your own plugin strategy for obtaining JDBC connections by implementing the interface <code class="interfacename">org.hibernate.connection.ConnectionProvider</code> and specifying your custom implementation with the <span class="property">hibernate.connection.provider_class</span> property.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id677478">1.2.5. Optional configuration properties</h3></div></div></div><div class="para">
				In addition to the properties mentioned in the previous sections, Hibernate includes many other optional properties. See <a class="xref" href="#appendix-Configuration_Properties">Appendix A, <i>Configuration properties</i></a> for a more complete list.
			</div></div></div><div class="section" id="configuring-dialects"><div class="titlepage"><div><div><h2 class="title" id="configuring-dialects">1.3. Dialects</h2></div></div></div><div class="para">
			Although SQL is relatively standardized, each database vendor uses a subset of supported syntax. This is reffered to as a <em class="firstterm">dialect</em>.
		</div><div class="para">
			Always set the <span class="property">hibernate.dialect</span> property to the correct <code class="classname">org.hibernate.dialect.Dialect</code> subclass for your database. If you specify a dialect, Hibernate uses sensible defaults for some of the other properties listed above, saving you the effort of setting them manually.
		</div><div class="table"><h6>Table 1.2. Supported database dialects</h6><div class="table-contents"><table summary="Supported database dialects" border="1"><colgroup><col width="120px" /><col width="320px" /></colgroup><thead><tr><th>
							Database
						</th><th>
							Dialect
						</th></tr></thead><tbody><tr><td>
							DB2
						</td><td>
							org.hibernate.dialect.DB2Dialect
						</td></tr><tr><td>
							DB2 AS/400
						</td><td>
							org.hibernate.dialect.DB2400Dialect
						</td></tr><tr><td>
							DB2 OS390
						</td><td>
							org.hibernate.dialect.DB2390Dialect
						</td></tr><tr><td>
							Firebird
						</td><td>
							org.hibernate.dialect.FirebirdDialect
						</td></tr><tr><td>
							FrontBase
						</td><td>
							org.hibernate.dialect.FrontbaseDialect
						</td></tr><tr><td>
							HypersonicSQL
						</td><td>
							org.hibernate.dialect.HSQLDialect
						</td></tr><tr><td>
							Informix
						</td><td>
							org.hibernate.dialect.InformixDialect
						</td></tr><tr><td>
							Interbase
						</td><td>
							org.hibernate.dialect.InterbaseDialect
						</td></tr><tr><td>
							Ingres
						</td><td>
							org.hibernate.dialect.IngresDialect
						</td></tr><tr><td>
							Microsoft SQL Server
						</td><td>
							org.hibernate.dialect.SQLServerDialect
						</td></tr><tr><td>
							Mckoi SQL
						</td><td>
							org.hibernate.dialect.MckoiDialect
						</td></tr><tr><td>
							MySQL
						</td><td>
							org.hibernate.dialect.MySQLDialect
						</td></tr><tr><td>
							MySQL with InnoDB
						</td><td>
							org.hibernate.dialect.MySQLInnoDBDialect
						</td></tr><tr><td>
							MySQL with MyISAM
						</td><td>
							org.hibernate.dialect.MySQLMyISAMDialect
						</td></tr><tr><td>
							Oracle (any version)
						</td><td>
							org.hibernate.dialect.OracleDialect
						</td></tr><tr><td>
							Oracle 9i
						</td><td>
							org.hibernate.dialect.Oracle9iDialect
						</td></tr><tr><td>
							Oracle 10g
						</td><td>
							org.hibernate.dialect.Oracle10gDialect
						</td></tr><tr><td>
							Pointbase
						</td><td>
							org.hibernate.dialect.PointbaseDialect
						</td></tr><tr><td>
							PostgreSQL
						</td><td>
							org.hibernate.dialect.PostgreSQLDialect
						</td></tr><tr><td>
							Progress
						</td><td>
							org.hibernate.dialect.ProgressDialect
						</td></tr><tr><td>
							SAP DB
						</td><td>
							org.hibernate.dialect.SAPDBDialect
						</td></tr><tr><td>
							Sybase
						</td><td>
							org.hibernate.dialect.SybaseDialect
						</td></tr><tr><td>
							Sybase Anywhere
						</td><td>
							org.hibernate.dialect.SybaseAnywhereDialect
						</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id597392">1.4. Automatic schema generation with SchemaExport</h2></div></div></div><div class="para">
			SchemaExport is a Hibernate utility which generates DDL from your mapping files. The generated schema includes referential integrity constraints, primary and foreign keys, for entity and collection tables. It also creates tables and sequences for mapped identifier generators.
		</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				You must specify a SQL Dialect via the <span class="property">hibernate.dialect</span> property when using this tool, because DDL is highly vendor-specific. See <a class="xref" href="#configuring-dialects">Section 1.3, “Dialects”</a> for information.
			</div></div></div><div class="para">
			Before Hibernate can generate your schema, you must customize your mapping files.
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id597425">1.4.1. Customizing the mapping files</h3></div></div></div><div class="para">
				Hibernate provides several elements and attributes to customize your mapping files. They are listed in <a class="xref" href="#tab-customizing-schema">Table 1.3, “Elements and attributes provided for customizing mapping files”</a>, and a logical order of customization is presented in <a class="xref" href="#proc-customizing-schema">Procedure 1.1, “Customizing the schema”</a>.
			</div><div class="table" id="tab-customizing-schema"><h6>Table 1.3. Elements and attributes provided for customizing mapping files</h6><div class="table-contents"><table summary="Elements and attributes provided for customizing mapping files" border="1"><colgroup><col width="80px" /><col width="80px" /><col width="280px" /></colgroup><thead><tr><th>
								Name
							</th><th>
								Type of value
							</th><th>
								Description
							</th></tr></thead><tbody><tr><td>
								length
							</td><td>
								number
							</td><td>
								Column length
							</td></tr><tr><td>
								precision
							</td><td>
								number
							</td><td>
								Decimal precision of column
							</td></tr><tr><td>
								scale
							</td><td>
								number
							</td><td>
								Decimal scale of column
							</td></tr><tr><td>
								not-null
							</td><td>
								<div class="para">
									<code class="literal">true</code> or <code class="literal">false</code>
								</div>
							</td><td>
								Whether a column is allowed to hold null values
							</td></tr><tr><td>
								unique
							</td><td>
								<div class="para">
									<code class="literal">true</code> or <code class="literal">false</code>
								</div>
							</td><td>
								Whether values in the column must be unique
							</td></tr><tr><td>
								index
							</td><td>
								string
							</td><td>
								The name of a multi-column index
							</td></tr><tr><td>
								unique-key
							</td><td>
								string
							</td><td>
								The name of a multi-column unique constraint
							</td></tr><tr><td>
								foreign-key
							</td><td>
								string
							</td><td>
								The name of the foreign key constraint generated for an association. This applies to &lt;one-to-one&gt;, &lt;many-to-one&gt;, &lt;key&gt;, and &lt;many-to-many&gt; mapping elements. <code class="literal">inverse="true"</code> sides are skipped by SchemaExport.
							</td></tr><tr><td>
								sql-type
							</td><td>
								string
							</td><td>
								Overrides the default column type. This applies to the &lt;column&gt; element only.
							</td></tr><tr><td>
								default
							</td><td>
								string
							</td><td>
								Default value for the column
							</td></tr><tr><td>
								check
							</td><td>
								string
							</td><td>
								An SQL check constraint on either a column or atable
							</td></tr></tbody></table></div></div><br class="table-break" /><div class="procedure" id="proc-customizing-schema"><h6>Procedure 1.1. Customizing the schema</h6><ol class="1"><li class="step"><p class="title"><b>Set the length, precision, and scale of mapping elements.</b></p><div class="para">
						Many Hibernate mapping elements define optional attributes named <code class="option">length</code>, <code class="option">precision</code>, and <code class="option">scale</code>.
					</div><pre class="programlisting XML"><span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"zip"</span><span class="perl_Others"> length=</span><span class="perl_String">"5"</span><span class="perl_Keyword">/&gt;</span>
<span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"balance"</span><span class="perl_Others"> precision=</span><span class="perl_String">"12"</span><span class="perl_Others"> scale=</span><span class="perl_String">"2"</span><span class="perl_Keyword">/&gt;</span></pre></li><li class="step"><p class="title"><b>Set the <code class="option">not-null</code>, <code class="option">UNIQUE</code>, <code class="option">unique-key</code> attributes.</b></p><div class="para">
						The <code class="option">not-null</code> and <code class="option">UNIQUE</code> attributes generate constraints on table columns.
					</div><div class="para">
						The unique-key attribute groups columns in a single, unique key constraint. Currently, the specified value of the unique-key attribute does not name the constraint in the generated DDL. It only groups the columns in the mapping file.
					</div><pre class="programlisting XML"><span class="perl_Keyword">&lt;many-to-one</span><span class="perl_Others"> name=</span><span class="perl_String">"bar"</span><span class="perl_Others"> column=</span><span class="perl_String">"barId"</span><span class="perl_Others"> not-null=</span><span class="perl_String">"true"</span><span class="perl_Keyword">/&gt;</span>
<span class="perl_Keyword">&lt;element</span><span class="perl_Others"> column=</span><span class="perl_String">"serialNumber"</span><span class="perl_Others"> type=</span><span class="perl_String">"long"</span><span class="perl_Others"> not-null=</span><span class="perl_String">"true"</span><span class="perl_Others"> unique=</span><span class="perl_String">"true"</span><span class="perl_Keyword">/&gt;</span>

<span class="perl_Keyword">&lt;many-to-one</span><span class="perl_Others"> name=</span><span class="perl_String">"org"</span><span class="perl_Others"> column=</span><span class="perl_String">"orgId"</span><span class="perl_Others"> unique-key=</span><span class="perl_String">"OrgEmployeeId"</span><span class="perl_Keyword">/&gt;</span>
<span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"employeeId"</span><span class="perl_Others"> unique-key=</span><span class="perl_String">"OrgEmployee"</span><span class="perl_Keyword">/&gt;</span></pre></li><li class="step"><p class="title"><b>Set the <code class="option">index</code> and <code class="option">foreign-key</code> attributes.</b></p><div class="para">
						The <code class="option">index</code> attribute specifies the name of an index for Hibernate to create using the mapped column or columns. You can group multiple columns into the same index by assigning them the same index name.
					</div><div class="para">
						A foreign-key attribute overrides the name of any generated foreign key constraint.
					</div><pre class="programlisting XML"><span class="perl_Keyword">&lt;many-to-one</span><span class="perl_Others"> name=</span><span class="perl_String">"bar"</span><span class="perl_Others"> column=</span><span class="perl_String">"barId"</span><span class="perl_Others"> foreign-key=</span><span class="perl_String">"FKFooBar"</span><span class="perl_Keyword">/&gt;</span></pre></li><li class="step"><p class="title"><b>Set child <code class="option">&lt;column&gt;</code> elements.</b></p><div class="para">
						Many mapping elements accept one or more child &lt;column&gt; elements. This is particularly useful for mapping types involving multiple columns.
					</div><pre class="programlisting XML"><span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"name"</span><span class="perl_Others"> type=</span><span class="perl_String">"my.customtypes.Name"</span><span class="perl_Keyword">/&gt;</span>
    <span class="perl_Keyword">&lt;column</span><span class="perl_Others"> name=</span><span class="perl_String">"last"</span><span class="perl_Others"> not-null=</span><span class="perl_String">"true"</span><span class="perl_Others"> index=</span><span class="perl_String">"bar_idx"</span><span class="perl_Others"> length=</span><span class="perl_String">"30"</span><span class="perl_Keyword">/&gt;</span>
    <span class="perl_Keyword">&lt;column</span><span class="perl_Others"> name=</span><span class="perl_String">"first"</span><span class="perl_Others"> not-null=</span><span class="perl_String">"true"</span><span class="perl_Others"> index=</span><span class="perl_String">"bar_idx"</span><span class="perl_Others"> length=</span><span class="perl_String">"20"</span><span class="perl_Keyword">/&gt;</span>
    <span class="perl_Keyword">&lt;column</span><span class="perl_Others"> name=</span><span class="perl_String">"initial"</span><span class="perl_Keyword">/&gt;</span>
<span class="perl_Error">&lt;</span>/property&gt;</pre></li><li class="step"><p class="title"><b>Set the <code class="option">default</code> attribute.</b></p><div class="para">
						The <code class="option">default</code> attribute represents a default value for a column. Assign the same value to the mapped property before saving a new instance of the mapped class.
					</div><pre class="programlisting XML"><span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"credits"</span><span class="perl_Others"> type=</span><span class="perl_String">"integer"</span><span class="perl_Others"> insert=</span><span class="perl_String">"false"</span><span class="perl_Keyword">&gt;</span>
    <span class="perl_Keyword">&lt;column</span><span class="perl_Others"> name=</span><span class="perl_String">"credits"</span><span class="perl_Others"> default=</span><span class="perl_String">"10"</span><span class="perl_Keyword">/&gt;</span>
<span class="perl_Keyword">&lt;/property&gt;</span>
<span class="perl_Keyword">&lt;version</span><span class="perl_Others"> name=</span><span class="perl_String">"version"</span><span class="perl_Others"> type=</span><span class="perl_String">"integer"</span><span class="perl_Others"> insert=</span><span class="perl_String">"false"</span><span class="perl_Keyword">&gt;</span>
    <span class="perl_Keyword">&lt;column</span><span class="perl_Others"> name=</span><span class="perl_String">"version"</span><span class="perl_Others"> default=</span><span class="perl_String">"0"</span><span class="perl_Keyword">/&gt;</span>
<span class="perl_Keyword">&lt;/property&gt;</span></pre></li><li class="step"><p class="title"><b>Set the <code class="option">sql-type</code> attribure.</b></p><div class="para">
						Use the <code class="option">sql-type</code> attribute to override the default mapping of a Hibernate type to SQL datatype.
					</div><pre class="programlisting XML"><span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"balance"</span><span class="perl_Others"> type=</span><span class="perl_String">"float"</span><span class="perl_Keyword">&gt;</span>
    <span class="perl_Keyword">&lt;column</span><span class="perl_Others"> name=</span><span class="perl_String">"balance"</span><span class="perl_Others"> sql-type=</span><span class="perl_String">"decimal(13,3)"</span><span class="perl_Keyword">/&gt;</span>
<span class="perl_Keyword">&lt;/property&gt;</span></pre></li><li class="step"><p class="title"><b>Set the <code class="option">check</code> attribute.</b></p><div class="para">
						use the <code class="option">check</code> attribute to specify a <em class="wordasword">check</em> constraint.
					</div><pre class="programlisting XML"><span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"foo"</span><span class="perl_Others"> type=</span><span class="perl_String">"integer"</span><span class="perl_Keyword">&gt;</span>
  <span class="perl_Keyword">&lt;column</span><span class="perl_Others"> name=</span><span class="perl_String">"foo"</span><span class="perl_Others"> check=</span><span class="perl_String">"foo &gt; 10"</span><span class="perl_Keyword">/&gt;</span>
<span class="perl_Keyword">&lt;/property&gt;</span>
<span class="perl_Keyword">&lt;class</span><span class="perl_Others"> name=</span><span class="perl_String">"Foo"</span><span class="perl_Others"> table=</span><span class="perl_String">"foos"</span><span class="perl_Others"> check=</span><span class="perl_String">"bar </span><span class="perl_Error">&lt;</span><span class="perl_String"> 100.0"</span><span class="perl_Keyword">&gt;</span>
  ...
  <span class="perl_Keyword">&lt;property</span><span class="perl_Others"> name=</span><span class="perl_String">"bar"</span><span class="perl_Others"> type=</span><span class="perl_String">"float"</span><span class="perl_Keyword">/&gt;</span>
<span class="perl_Keyword">&lt;/class&gt;</span></pre></li><li class="step"><p class="title"><b>Add &lt;comment&gt; elements to your schema.</b></p><div class="para">
						Use the &lt;comment&gt; element to specify comments for the generated schema.
					</div><pre class="programlisting XML"><span class="perl_Keyword">&lt;class</span><span class="perl_Others"> name=</span><span class="perl_String">"Customer"</span><span class="perl_Others"> table=</span><span class="perl_String">"CurCust"</span><span class="perl_Keyword">&gt;</span>
  <span class="perl_Keyword">&lt;comment&gt;</span>Current customers only<span class="perl_Keyword">&lt;/comment&gt;</span>
  ...
<span class="perl_Keyword">&lt;/class&gt;</span></pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id666486">1.4.2. Running the SchemaExport tool</h3></div></div></div><div class="para">
				The SchemaExport tool writes a DDL script to standard output, executes the DDL statements, or both.
			</div><div class="example"><h6>Example 1.6. SchemaExport syntax</h6><div class="example-contents"><pre class="screen">
          java -cp hibernate_classpaths org.hibernate.tool.hbm2ddl.SchemaExport <em class="replaceable"><code>options</code></em> <em class="replaceable"><code>mapping_files</code></em> 
</pre></div></div><br class="example-break" /><div class="table"><h6>Table 1.4. SchemaExport Options</h6><div class="table-contents"><table summary="SchemaExport Options" border="1"><colgroup><col width="120px" /><col width="320px" /></colgroup><thead><tr><th>
								Option
							</th><th>
								Description
							</th></tr></thead><tbody><tr><td>
								--quiet
							</td><td>
								do not output the script to standard output
							</td></tr><tr><td>
								--drop
							</td><td>
								only drop the tables
							</td></tr><tr><td>
								--create
							</td><td>
								only create the tables
							</td></tr><tr><td>
								--text
							</td><td>
								do not export to the database
							</td></tr><tr><td>
								<div class="para">
									--output=<em class="replaceable"><code>my_schema.ddl</code></em>
								</div>
							</td><td>
								output the ddl script to a file
							</td></tr><tr><td>
								<div class="para">
									--naming=<em class="replaceable"><code>eg.MyNamingStrategy</code></em>
								</div>
							</td><td>
								select a NamingStrategy
							</td></tr><tr><td>
								<div class="para">
									--config=<em class="replaceable"><code>hibernate.cfg.xml</code></em>
								</div>
							</td><td>
								read Hibernate configuration from an XML file
							</td></tr><tr><td>
								<div class="para">
									--properties=<em class="replaceable"><code>hibernate.properties</code></em>
								</div>
							</td><td>
								read database properties from a file
							</td></tr><tr><td>
								--format
							</td><td>
								format the generated SQL nicely in the script
							</td></tr><tr><td>
								<div class="para">
									--delimiter=<em class="replaceable"><code>;</code></em>
								</div>
							</td><td>
								set an end-of-line delimiter for the script
							</td></tr></tbody></table></div></div><br class="table-break" /><div class="example"><h6>Example 1.7. Embedding SchemaExport into your application</h6><div class="example-contents"><pre class="programlisting JAVA">Configuration cfg = ....;
<span class="perl_Keyword">new</span> <span class="perl_Function">SchemaExport</span>(cfg).<span class="perl_Function">create</span>(<span class="perl_Keyword">false</span>, <span class="perl_Keyword">true</span>);</pre></div></div><br class="example-break" /></div></div></div><div xml:lang="en-US" class="chapter" id="id555174" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 2. Transactions and concurrency control</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#id668100">2.1. Defining a transaction</a></span></dt><dt><span class="section"><a href="#id684108">2.2. How Hibernate uses transactions</a></span></dt><dt><span class="section"><a href="#id626099">2.3. Transaction Scopes</a></span></dt><dd><dl><dt><span class="section"><a href="#session-per-operation">2.3.1. Session-per-operation</a></span></dt><dt><span class="section"><a href="#id628065">2.3.2. Session-per-request</a></span></dt><dt><span class="section"><a href="#long-conversations">2.3.3. Conversations</a></span></dt><dt><span class="section"><a href="#id700984">2.3.4. Object identity</a></span></dt><dt><span class="section"><a href="#transaction-antipatterns">2.3.5. Problems and antipatterns</a></span></dt></dl></dd><dt><span class="section"><a href="#id676832">2.4. Types</a></span></dt><dt><span class="section"><a href="#hibernate-transaction-api">2.5. Hibernate Transaction API (JTA)</a></span></dt><dd><dl><dt><span class="section"><a href="#id676858">2.5.1. Bean-managed transactions (BMT)</a></span></dt><dt><span class="section"><a href="#id676931">2.5.2. Container-managed transactions (CMT)</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id668100">2.1. Defining a transaction</h2></div></div></div><div class="para">
			A transaction, or unit of work, encompasses a group of potential decisions between your application and the datasources it uses to store information. The role of a transaction is to ensure data integrity by causing the datasources to all commit, or all roll back, in agreement with each other and your application.
		</div><div class="para">
			An example of when transactions might be useful is a travel agency, which only charges a customer's credit card if the plane tickets are available and the credit card has adequate funds to pay for the tickets. If the card is charged, but the tickets are not available, data integrity is not maintained.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id684108">2.2. How Hibernate uses transactions</h2></div></div></div><div class="para">
			Hibernate uses JDBC connections and JTA resources directly, without adding any additional locking behavior. It is important for you to become familiar with the JBDC, ANSI, and transaction isolation specification of your database management system.
		</div><div class="para">
			Hibernate does not lock objects in memory. The behavior defined by the isolation level of your database transactions does not change when you use Hibernate. Through <code class="classname">Session</code>, which is also a transaction-scoped cache, Hibernate provides repeatable reads for lookup by identifier and entity queries and not-reporting queries that return scalar values.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id626099">2.3. Transaction Scopes</h2></div></div></div><div class="para">
			A <code class="classname">SessionFactory</code> is an expensive-to-create, thread-safe object, which all application threads can share. It is created once, usually on application startup, from a <code class="classname">Configuration</code> instance.
		</div><div class="para">
			A <code class="classname">Session</code> is an inexpensive, non-thread-safe object. Use it once and then discard it. You can use it for a single request, a conversation, or a single unit of work. A <code class="classname">Session</code> does not obtain a JDBC Connection, or a Datasource, unless it is needed. It does not consume any resources until you use it.
		</div><div class="para">
			To reduce lock contention in the database, a database transaction needs to be as short as possible. Long database transactions prevent your application from scaling to a highly-concurrent load. Do not hold a database transaction open during user-level work, but open it after the user-level work is finished.
		</div><div class="section" id="session-per-operation"><div class="titlepage"><div><div><h3 class="title" id="session-per-operation">2.3.1. Session-per-operation</h3></div><div><h2 class="subtitle">Antipatterns to avoid</h2></div></div></div><div class="para">
				<em class="firstterm">Session-per-operation</em> refers to the antipattern of opening and closing a <code class="classname">Session</code> for each database call in a single thread. It is also an antipattern in terms of database transactions. Group your database calls into a planned sequence. In the same way, do not auto-commit after every SQL statement in your application. Hibernate disables, or expects the application server to disable, auto-commit mode immediately. Database transactions are never optional. All communication with a database must be encapsulated by a transaction. Avoid auto-commit behavior for reading data, because many small transactions are unlikely to perform better than one clearly-defined unit of work, and are more difficult to maintain and extend.
			</div><div class="para">
				For more antipatterns to avoid, see <a class="xref" href="#transaction-antipatterns">Section 2.3.5, “Problems and antipatterns”</a>.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id628065">2.3.2. Session-per-request</h3></div><div><h2 class="subtitle">The typical desired pattern</h2></div></div></div><div class="para">
				The most common pattern in a multi-user client/server application is <em class="firstterm">session-per-request</em>. In this model, a client sends a request to the server, where the Hibernate persistence layer is running. Hibernate opens a new Session, and all database operations are executed in this unit of work. After the work is completed, and the server prepares the response for the client, the session is flushed and closed. Use a single database transaction to serve the clients request, starting and committing it when you open and close the Session. The relationship between the transaction and the Session is one-to-one.
			</div><div class="para">
				Hibernate provides built-in management of the <em class="firstterm">current session</em> to simplify the session-per-request pattern. Start a transaction to process a server request, and end the transaction before sending the response to the client. Common solutions include:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						ServletFilter
					</div></li><li class="listitem"><div class="para">
						AOP interceptor with a pointcut on the service methods
					</div></li><li class="listitem"><div class="para">
						A proxy/interception container
					</div></li></ul></div><div class="para">
				An EJB container is a standardized way to implement cross-cutting aspects such as transaction demarcation on EJB session beans, declaratively with CMT. If you use programmatic transaction demarcation, use the <a class="xref" href="#hibernate-transaction-api">Section 2.5, “Hibernate Transaction API (JTA)”</a>.
			</div><div class="para">
				To access a current session to process the request, call method <code class="methodname">sessionFactory.getCurrentSession()</code>. The returned <code class="classname">Session</code> is scoped to the current database transaction. You need to configure this for either resource-local or JTA environments
			</div><div class="para">
				You can extend the scope of a <code class="classname">Session</code> and database transaction until the view is rendered. This is especially useful in servlet applications that include a separate rendering phase after the request is processed. To extending the database transaction until view rendering, implement your own interceptor. This implementation is difficult if you rely on EJBs with container-managed transactions. A transaction is completed when an EJB method returns, before rendering of any view can start. Search the Hibernate forums for tips and examples relating to this <span>Open Session in View</span> pattern.
			</div><div class="para">
				If <span>session-per-request</span> does not seem well-suited for your application, refer to <a class="xref" href="#long-conversations">Section 2.3.3, “Conversations”</a> for another choice.
			</div></div><div class="section" id="long-conversations"><div class="titlepage"><div><div><h3 class="title" id="long-conversations">2.3.3. Conversations</h3></div><div><h2 class="subtitle">An alternate pattern to <span>session-per-request</span></h2></div></div></div><div class="para">
				The <span>session-per-request</span> pattern is not the only way of designing units of work. Many business processes require a whole series of interactions with the user that are interleaved with database accesses. In web and enterprise applications, it is not acceptable for a database transaction to span a user interaction. Consider the following example:
			</div><div class="procedure"><h6>Procedure 2.1. An example of a long-running conversation</h6><ol class="1"><li class="step"><div class="para">
						The first screen of a dialog opens. The data seen by the user is loaded in a particular <code class="classname">Session</code> and database transaction. The user is free to modify the objects.
					</div></li><li class="step"><div class="para">
						The user uses a UI element to save their work after five minutes of editing. The modifications are made persistent. The user also expects to have exclusive access to the data during the edit session.
					</div></li></ol></div><div class="para">
				From the point of view of the user, this unit of work is a long-running conversation or application transaction. There are many ways to implement this in your application.
			</div><div class="para">
				A first naive implementation might keep the <code class="classname">Session</code> and database transaction open while the user is editing, using database-level locks to prevent other users from modifying the same data and to guarantee isolation and atomicity. This is an anti-pattern, because lock contention is a bottleneck which will prevent scalability in the future.
			</div><div class="para">
				Several database transactions are used to implement the conversation. In this case, maintaining isolation of business processes becomes the partial responsibility of the application tier. A single conversation usually spans several database transactions. It is atomic if only one of these database transactions, typically the last one, stores the updated data. All others only read data. A common way to receive this data is through a wizard-style dialog spanning several request/response cycles. Hibernate includes some features which make this easy to implement.
			</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><tbody><tr><td>
								<div class="para">
									Automatic Versioning
								</div>

							</td><td>
								<div class="para">
									Hibernate can perform automatic optimistic concurrency control for you. It can automatically detect if a concurrent modification occurred during user think time. Check for this at the end of the conversation.
								</div>

							</td></tr><tr><td>
								<div class="para">
									Detached Objects
								</div>

							</td><td>
								<div class="para">
									If you decide to use the session-per-request pattern, all loaded instances will be in the detached state during user think time. Hibernate allows you to reattach the objects and persist the modifications. The pattern is called session-per-request-with-detached-objects. Automatic versioning is used to isolate concurrent modifications.
								</div>

							</td></tr><tr><td>
								<div class="para">
									Extended (or Long) Session
								</div>

							</td><td>
								<div class="para">
									Extended (or Long) Session: the Hibernate Session can be disconnected from the underlying JDBC connection after the database transaction has been committed and reconnected when a new client request occurs. This pattern is known as session-per-conversation and makes even reattachment unnecessary. Automatic versioning is used to isolate concurrent modifications and the Session will not be allowed to be flushed automatically, but explicitly.
								</div>

							</td></tr></tbody></table></div><div class="para">
				<span>Session-per-request-with-detached-objects</span> and <span>session-per-conversation</span> each have advantages and disadvantages.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id700984">2.3.4. Object identity</h3></div></div></div><div class="para">
				An application can concurrently access the same persistent state in two different Sessions. However, an instance of a persistent class is never shared between two <code class="classname">Session</code> instances. Therefore, two different notions of identity exist: Database identity and JVM identity.
			</div><div class="example"><h6>Example 2.1. Database identity</h6><div class="example-contents"><pre class="programlisting JAVA">foo.<span class="perl_Function">getId</span>().<span class="perl_Function">equals</span>( bar.<span class="perl_Function">getId</span>() )</pre></div></div><br class="example-break" /><div class="example"><h6>Example 2.2. JVM identity</h6><div class="example-contents"><pre class="programlisting JAVA">foo==bar</pre></div></div><br class="example-break" /><div class="para">
				For objects attached to a particular Session, the two notions are equivalent, and JVM identity for database identity is guaranteed by Hibernate. The application might concurrently access a business object with the same identity in two different sessions, the two instances are actually actually different, in terms of JVM identity. Conflicts are resolved using an optimistic approach and automatic versioning at flush/commit time.
			</div><div class="para">
				This approach places responsibility for conscurrency on Hibernate and the database. It also provides the best scalability, since expensive locking is not needed to guarantee identity in single-threaded units of work. The application does not need to synchronize on any business object, as long as it maintains a single thread per <code class="classname">Session</code>. Within a <code class="classname">Session</code> the application can safely use the <code class="literal">==</code> operator to compare objects.
			</div><div class="para">
				However, an application that uses the <code class="literal">==</code> operator outside of a <code class="classname">Session</code> may introduce problems.. If you put two detached instances into the same <code class="classname">Set</code>, they might use the same database identity, which means they represent the same row in the database. They would not be guaranteed to have the same JVM identity if they are in a detached state. Override the <code class="methodname">equals</code> and <code class="methodname">hashCode</code> methods in persistant classes, so that they have their own notion of object equality. Never use the database identifier to implement equality. Instead, use a business key that is a combination of unique, typically immutable, attributes. The database identifier changes if a transient object is made persistent. If the transient instance, together with detached instances, is held in a <code class="classname">Set</code>, changing the hashcode breaks the contract of the <code class="classname">Set</code>. Attributes for business keys can be less stable than database primary keys. You only need to guarantee stability as long as the objects are in the same <code class="classname">Set</code>.This is not a Hibernate issue, but relates to Java's implementation of object identity and equality.
			</div></div><div class="section" id="transaction-antipatterns"><div class="titlepage"><div><div><h3 class="title" id="transaction-antipatterns">2.3.5. Problems and antipatterns</h3></div></div></div><div class="para">
				Avoid the anti-patterns session-per-user-session or session-per-application, for the most part. The reasons are outlined in <a class="xref" href="#session-per-operation">Section 2.3.1, “Session-per-operation”</a>. In addition, keep the following points in mind when choosing patterns for your application.
			</div><div class="variablelist"><dl><dt class="varlistentry"><span class="term">A <code class="classname">Session</code> is not thread-safe.</span></dt><dd><div class="para">
							Resources, such as HTTP requests, session beans, or Swing workers, cause race conditions if a <code class="classname">Session</code> instance is shared. If you keep your Hibernate <code class="classname">Session</code> in your <code class="classname">HttpSession</code>, consider synchronizing access to your <code class="classname">Http</code> session. Otherwise, a reloaded application may use the same <code class="classname">Session</code> in two concurrently-running threads.
						</div></dd><dt class="varlistentry"><span class="term">If Hibernate throws an exception, you must rullback your database transaction and close the <code class="classname">Session</code> immediately.</span></dt><dd><div class="para">
							In addition to the above, if your Session is bound to the application, you must stop the application. Rolling back the database transaction does not put your business objects back into their state at the start of the transaction. The database state and the business objects will be out of sync. Since exceptions are not recoverable, this is typically not a problem. You must start over after rollback anyway.
						</div></dd><dt class="varlistentry"><span class="term">The Session caches every object that is in a persistent state.</span></dt><dd><div class="para">
							A persistent state refers to objects that are watched and checked for dirty state by Hibernate. If you keep the cache open for a long time or load too much data, it grows to fill available memory, causing an OutOfMemoryException.
						</div><div class="para">
							To solve this problem, you can call <code class="methodname">clear()</code> and <code class="methodname">evict()</code> to manage the <code class="classname">Session</code> cache. Alternately, you can use a Stored Procedure if you need mass data operations. Keeping a <code class="classname">Session</code> open for the duration of a user session reduces the probability of stale data.
						</div></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id676832">2.4. Types</h2></div></div></div><div class="para">

		</div></div><div class="section" id="hibernate-transaction-api"><div class="titlepage"><div><div><h2 class="title" id="hibernate-transaction-api">2.5. Hibernate Transaction API (JTA)</h2></div></div></div><div class="para">
			If your persistence layer runs in an application server, such as behind EJB session beans, every datasource connection obtained by Hibernate is automatically part of the global JTA transaction. You can also install a standalone JTA implementation and use it without EJB. Hibernate offers two strategies for JTA integration.
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id676858">2.5.1. Bean-managed transactions (BMT)</h3></div></div></div><div class="para">
				If you use bean-managed transactions (BMT), Hibernate tells the application server to start and end a BMT transaction if you use the Transaction API. The transaction management code is identical to the non-managed environment.
			</div><div class="example"><h6>Example 2.3. BMT idiom</h6><div class="example-contents"><pre class="programlisting JAVA"><span class="perl_Comment">// BMT idiom</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>Session sess = factory.<span class="perl_Function">openSession</span>();
Transaction tx = <span class="perl_Keyword">null</span>;
<span class="perl_Keyword">try</span> {
    tx = sess.<span class="perl_Function">beginTransaction</span>();

    <span class="perl_Comment">// do some work</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>    <span class="perl_Keyword">...</span>
<span class="perl_Keyword">
        </span>tx.<span class="perl_Function">commit</span>();
}

<span class="perl_Keyword">catch</span> (RuntimeException e) {
    <span class="perl_Keyword">if</span> (tx != <span class="perl_Keyword">null</span>) tx.<span class="perl_Function">rollback</span>();
    <span class="perl_Keyword">throw</span> e; <span class="perl_Comment">// or display error message</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>}

<span class="perl_Keyword">finally</span> {
    sess.<span class="perl_Function">close</span>();
}</pre></div></div><br class="example-break" /><div class="para">
				Alternately, you can use a transaction-bound Session. If you need the <code class="methodname">getCurrentSession()</code> functionality for easy context propagation, use the JTA UserTransaction API directly.
			</div><div class="example"><h6>Example 2.4. BMT idiom with <code class="methodname">getCurrentSession()</code></h6><div class="example-contents"><pre class="programlisting JAVA"><span class="perl_Comment">// BMT idiom with getCurrentSession()</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span><span class="perl_Keyword">try</span> {
    UserTransaction tx = (UserTransaction)<span class="perl_Keyword">new</span> InitialContext()
                            .<span class="perl_Function">lookup</span>(<span class="perl_String">"java:comp/UserTransaction"</span>);

    tx.<span class="perl_Function">begin</span>();

    <span class="perl_Comment">// Do some work on Session bound to transaction</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>    factory.<span class="perl_Function">getCurrentSession</span>().<span class="perl_Function">load</span>(...);
    factory.<span class="perl_Function">getCurrentSession</span>().<span class="perl_Function">persist</span>(...);

    tx.<span class="perl_Function">commit</span>();
}

<span class="perl_Keyword">catch</span> (RuntimeException e) {
    tx.<span class="perl_Function">rollback</span>();
    <span class="perl_Keyword">throw</span> e; <span class="perl_Comment">// or display error message</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>}</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id676931">2.5.2. Container-managed transactions (CMT)</h3></div></div></div><div class="para">
				With CMT, transaction demarcation is completed in session bean deployment descriptors, rather than programmatically.This reduces the amount of code.
			</div><div class="example"><h6>Example 2.5. CMT idiom</h6><div class="example-contents"><pre class="programlisting JAVA"><span class="perl_Comment">// CMT idiom</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span> Session sess = factory.<span class="perl_Function">getCurrentSession</span>();
 <span class="perl_Comment">// do some work</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span> <span class="perl_Keyword">...</span>
<span class="perl_Keyword"></span></pre></div></div><br class="example-break" /><div class="para">
				In a CMT/EJB, rollback happens automatically as well. An unhandled <code class="systemitem">RuntimeException</code> thrown by a session bean method tells the container to set the global transaction to rollback. You do not need to intervene, and you get automatic propagation of the <code class="classname">Current</code> <code class="classname">Session</code> bound to the transaction.
			</div><div class="para">
				When configuring Hibernate's transaction factory, choose <code class="classname">org.hibernate.transaction.JTATransactionFactory</code> if you use JTA directly (BMT), and <code class="classname">org.hibernate.transaction.CMTTransactionFactory</code> in a CMT session bean. Set the <code class="varname">hibernate.transaction.manager_lookup_class</code> property as well. Ensure that your <code class="classname">hibernate.current_session_context_class</code> is either unset, or is set to <code class="literal">jta</code>.
			</div><div class="para">
				The <code class="methodname">getCurrentSession()</code> method has one downside in a JTA environment. If you use it, after_statement connection release mode is also used by default. Due to a limitation of the JTA specification, Hibernate cannot automatically clean up any unclosed <code class="classname">ScrollableResults</code> or <code class="classname">Iterator</code> instances returned by <code class="methodname">scroll()</code> or <code class="methodname">iterate()</code>. Release the underlying database cursor by calling <code class="methodname">ScrollableResults.close()</code> or <code class="methodname">Hibernate.close(Iterator)</code> explicitly from a <code class="systemitem">finally</code> block. Try to avoid using <code class="methodname">scroll()</code> or <code class="methodname">iterate()</code> from the JTA or CMT code.
			</div></div></div></div><div xml:lang="en-US" class="chapter" id="id703804" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 3. Batch Processing</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#id555276">3.1. Batch inserts</a></span></dt><dt><span class="section"><a href="#id674521">3.2. Batch updates</a></span></dt><dt><span class="section"><a href="#id668971">3.3. StatelessSession</a></span></dt><dt><span class="section"><a href="#id676168">3.4. Hibernate Query Language for DML</a></span></dt><dd><dl><dt><span class="section"><a href="#id676198">3.4.1. HQL for UPDATE and DELETE</a></span></dt><dt><span class="section"><a href="#id593574">3.4.2. HQL syntax for INSERT</a></span></dt><dt><span class="section"><a href="#id606598">3.4.3. More information on HQL</a></span></dt></dl></dd></dl></div><div class="para">
		The following example shows an antipattern for batch inserts.
	</div><div class="example"><h6>Example 3.1. Naive way to insert 100000 lines with Hibernate</h6><div class="example-contents"><pre class="programlisting JAVA">Session session = sessionFactory.<span class="perl_Function">openSession</span>();
Transaction tx = session.<span class="perl_Function">beginTransaction</span>();
<span class="perl_Keyword">for</span> ( <span class="perl_DataType">int</span> i=<span class="perl_Float">0</span>; i&lt;<span class="perl_Float">100000</span>; i++ ) {
    Customer customer = <span class="perl_Keyword">new</span> <span class="perl_Function">Customer</span>(.....);
    session.<span class="perl_Function">save</span>(customer);
}
tx.<span class="perl_Function">commit</span>();
session.<span class="perl_Function">close</span>();</pre><div class="para">
			This fails with exception <code class="systemitem">OutOfMemoryException</code> after around 50000 rows on most systems. The reason is that Hibernate caches all the newly inserted Customer instances in the session-level cache. There are several ways to avoid this problem.
		</div></div></div><br class="example-break" /><div class="para">
		Before batch processing, enable JDBC batching. To enable JDBC batching, set the property <span class="property">hibernate.jdbc.batch_size</span> to an integer between 10 and 50.
	</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
			Hibernate disables insert batching at the JDBC level transparently if you use an identity identifier generator.
		</div></div></div><div class="para">
		If the above approach is not appropriate, you can disable the second-level cache, by setting <span class="property">hibernate.cache.use_second_level_cache</span> to <code class="literal">false</code>.
	</div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id555276">3.1. Batch inserts</h2></div></div></div><div class="para">
			When you make new objects persistent, employ methods <code class="methodname">flush()</code> and <code class="methodname">clear()</code> to the session regularly, to control the size of the first-level cache.
		</div><div class="example"><h6>Example 3.2. Flushing and clearing the <code class="classname">Session</code></h6><div class="example-contents"><pre class="programlisting JAVA">Session session = sessionFactory.<span class="perl_Function">openSession</span>();
Transaction tx = session.<span class="perl_Function">beginTransaction</span>();
   
<span class="perl_Keyword">for</span> ( <span class="perl_DataType">int</span> i=<span class="perl_Float">0</span>; i&lt;<span class="perl_Float">100000</span>; i++ ) {
    Customer customer = <span class="perl_Keyword">new</span> <span class="perl_Function">Customer</span>(.....);
    session.<span class="perl_Function">save</span>(customer);
    <span class="perl_Keyword">if</span> ( i % <span class="perl_Float">20</span> == <span class="perl_Float">0</span> ) { <span class="perl_Comment">//20, same as the JDBC batch size</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>        <span class="perl_Comment">//flush a batch of inserts and release memory:</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>        session.<span class="perl_Function">flush</span>();
        session.<span class="perl_Function">clear</span>();
    }
}
   
tx.<span class="perl_Function">commit</span>();
session.<span class="perl_Function">close</span>();</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id674521">3.2. Batch updates</h2></div></div></div><div class="para">
			When you retriev and update data, <code class="methodname">flush()</code> and <code class="methodname">clear()</code> the session regularly. In addition, use method <code class="methodname">scroll()</code> to take advantage of server-side cursors for queries that return many rows of data.
		</div><div class="example"><h6>Example 3.3. Using <code class="methodname">scroll()</code></h6><div class="example-contents"><pre class="programlisting JAVA">Session session = sessionFactory.<span class="perl_Function">openSession</span>();
Transaction tx = session.<span class="perl_Function">beginTransaction</span>();
   
ScrollableResults customers = session.<span class="perl_Function">getNamedQuery</span>(<span class="perl_String">"GetCustomers"</span>)
    .<span class="perl_Function">setCacheMode</span>(CacheMode.<span class="perl_Function">IGNORE</span>)
    .<span class="perl_Function">scroll</span>(ScrollMode.<span class="perl_Function">FORWARD_ONLY</span>);
<span class="perl_DataType">int</span> count=<span class="perl_Float">0</span>;
<span class="perl_Keyword">while</span> ( customers.<span class="perl_Function">next</span>() ) {
    Customer customer = (Customer) customers.<span class="perl_Function">get</span>(<span class="perl_Float">0</span>);
    customer.<span class="perl_Function">updateStuff</span>(...);
    <span class="perl_Keyword">if</span> ( ++count % <span class="perl_Float">20</span> == <span class="perl_Float">0</span> ) {
        <span class="perl_Comment">//flush a batch of updates and release memory:</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>        session.<span class="perl_Function">flush</span>();
        session.<span class="perl_Function">clear</span>();
    }
}
   
tx.<span class="perl_Function">commit</span>();
session.<span class="perl_Function">close</span>();</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id668971">3.3. StatelessSession</h2></div></div></div><div class="para">
			<code class="interfacename">StatelessSession</code> is a command-oriented API provided by Hibernate. Use it to stream data to and from the database in the form of detached objects. A <code class="interfacename">StatelessSession</code> has no persistence context associated with it and does not provide many of the higher-level life cycle semantics. Some of the things not provided by a <code class="interfacename">StatelessSession</code> include:
		</div><div class="itemizedlist"><h6>Features and behaviors not provided by <code class="interfacename">StatelessSession</code></h6><ul><li class="listitem"><div class="para">
					a first-level cache
				</div></li><li class="listitem"><div class="para">
					interaction with any second-level or query cache
				</div></li><li class="listitem"><div class="para">
					transactional write-behind or automatic dirty checking
				</div></li></ul></div><div class="itemizedlist"><h6>Limitations of <code class="interfacename">StatelessSession</code></h6><ul><li class="listitem"><div class="para">
					Operations performed using a stateless session never cascade to associated instances.
				</div></li><li class="listitem"><div class="para">
					Collections are ignored by a stateless session.
				</div></li><li class="listitem"><div class="para">
					Operations performed via a stateless session bypass Hibernate's event model and interceptors.
				</div></li><li class="listitem"><div class="para">
					Due to the lack of a first-level cache, Stateless sessions are vulnerable to data aliasing effects.
				</div></li><li class="listitem"><div class="para">
					A stateless session is a lower-level abstraction that is much closer to the underlying JDBC.
				</div></li></ul></div><div class="example"><h6>Example 3.4. Using a <code class="interfacename">StatelessSession</code></h6><div class="example-contents"><pre class="programlisting JAVA">StatelessSession session = sessionFactory.<span class="perl_Function">openStatelessSession</span>();
Transaction tx = session.<span class="perl_Function">beginTransaction</span>();
   
ScrollableResults customers = session.<span class="perl_Function">getNamedQuery</span>(<span class="perl_String">"GetCustomers"</span>)
    .<span class="perl_Function">scroll</span>(ScrollMode.<span class="perl_Function">FORWARD_ONLY</span>);
<span class="perl_Keyword">while</span> ( customers.<span class="perl_Function">next</span>() ) {
    Customer customer = (Customer) customers.<span class="perl_Function">get</span>(<span class="perl_Float">0</span>);
    customer.<span class="perl_Function">updateStuff</span>(...);
    session.<span class="perl_Function">update</span>(customer);
}
   
tx.<span class="perl_Function">commit</span>();
session.<span class="perl_Function">close</span>();</pre><div class="para">
				The <code class="classname">Customer</code> instances returned by the query are immediately detached. They are never associated with any persistence context.
			</div></div></div><br class="example-break" /><div class="para">
			The <code class="methodname">insert()</code>, <code class="methodname">update()</code>, and <code class="methodname">delete()</code> operations defined by the <code class="interfacename">StatelessSession</code> interface operate directly on database rows. They cause the corresponding SQL operations to be executed immediately. They have different semantics from the <code class="methodname">save()</code>, <code class="methodname">saveOrUpdate()</code>, and <code class="methodname">delete()</code> operations defined by the <code class="interfacename">Session</code> interface.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id676168">3.4. Hibernate Query Language for DML</h2></div></div></div><div class="para">
			DML, or <em class="firstterm">Data Markup Language</em>, refers to SQL statements such as <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, and <code class="literal">DELETE</code>. Hibernate provides methods for bulk SQL-style DML statement execution, in the form of <em class="firstterm">Hibernate Query Language (HQL)</em>.
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id676198">3.4.1. HQL for UPDATE and DELETE</h3></div></div></div><div class="example"><h6>Example 3.5. Psuedo-syntax for UPDATE and DELETE statements using HQL</h6><div class="example-contents"><pre class="screen">
          ( UPDATE | DELETE ) FROM? EntityName (WHERE where_conditions)?
</pre><div class="para">
					The <code class="literal">?</code> suffix indications an optional parameter. The <code class="literal">FROM</code> and <code class="literal">WHERE</code> clauses are each optional.
				</div></div></div><br class="example-break" /><div class="para">
				The <code class="literal">FROM</code> clause can only refer to a single entity, which can be aliased. If the entity name is aliased, any property references must be qualified using that alias. If the entity name is not aliased, then it is illegal for any property references to be qualified.
			</div><div class="para">
				Joins, either implicit or explicit, are prohibited in a bulk HQL query. You can use sub-queries in the <code class="literal">WHERE</code> clause, and the sub-queries themselves can contain joins.
			</div><div class="example"><h6>Example 3.6. Executing an HQL UPDATE, using the <code class="methodname">Query.executeUpdate()</code> method</h6><div class="example-contents"><pre class="programlisting JAVA">Session session = sessionFactory.<span class="perl_Function">openSession</span>();
Transaction tx = session.<span class="perl_Function">beginTransaction</span>();

String hqlUpdate = <span class="perl_String">"update Customer c set c.name = :newName where c.name = :oldName"</span>;
<span class="perl_Comment">// or String hqlUpdate = "update Customer set name = :newName where name = :oldName";</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span><span class="perl_DataType">int</span> updatedEntities = s.<span class="perl_Function">createQuery</span>( hqlUpdate )
        .<span class="perl_Function">setString</span>( <span class="perl_String">"newName"</span>, newName )
        .<span class="perl_Function">setString</span>( <span class="perl_String">"oldName"</span>, oldName )
        .<span class="perl_Function">executeUpdate</span>();
tx.<span class="perl_Function">commit</span>();
session.<span class="perl_Function">close</span>();</pre></div></div><br class="example-break" /><div class="para">
				In keeping with the EJB3 specification, HQL UPDATE statements, by default, do not effect the version or the timestamp property values for the affected entities. You can use a versioned update to force Hibernate to reset the version or timestamp property values, by adding the <code class="literal">VERSIONED</code> keyword after the <code class="literal">UPDATE</code> keyword.
			</div><div class="example"><h6>Example 3.7. Updating the version of timestamp</h6><div class="example-contents"><pre class="programlisting JAVA">Session session = sessionFactory.<span class="perl_Function">openSession</span>();
Transaction tx = session.<span class="perl_Function">beginTransaction</span>();
String hqlVersionedUpdate = <span class="perl_String">"update versioned Customer set name = :newName where name = :oldName"</span>;
<span class="perl_DataType">int</span> updatedEntities = s.<span class="perl_Function">createQuery</span>( hqlUpdate )
        .<span class="perl_Function">setString</span>( <span class="perl_String">"newName"</span>, newName )
        .<span class="perl_Function">setString</span>( <span class="perl_String">"oldName"</span>, oldName )
        .<span class="perl_Function">executeUpdate</span>();
tx.<span class="perl_Function">commit</span>();
session.<span class="perl_Function">close</span>();</pre></div></div><br class="example-break" /><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					If you use the <code class="literal">VERSIONED</code> statement, you cannot use custom version types, which use class <code class="classname">org.hibernate.usertype.UserVersionType</code>.
				</div></div></div><div class="example"><h6>Example 3.8. A HQL <code class="literal">DELETE</code> statement</h6><div class="example-contents"><pre class="programlisting JAVA">Session session = sessionFactory.<span class="perl_Function">openSession</span>();
Transaction tx = session.<span class="perl_Function">beginTransaction</span>();

String hqlDelete = <span class="perl_String">"delete Customer c where c.name = :oldName"</span>;
<span class="perl_Comment">// or String hqlDelete = "delete Customer where name = :oldName";</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span><span class="perl_DataType">int</span> deletedEntities = s.<span class="perl_Function">createQuery</span>( hqlDelete )
        .<span class="perl_Function">setString</span>( <span class="perl_String">"oldName"</span>, oldName )
        .<span class="perl_Function">executeUpdate</span>();
tx.<span class="perl_Function">commit</span>();
session.<span class="perl_Function">close</span>();</pre></div></div><br class="example-break" /><div class="para">
				Method <code class="methodname">Query.executeUpdate()</code> returns an <span class="type">int</span> value, which indicates the number of entities effected by the operation. This may or may not correlate to the number of rows effected in the database. An HQL bulk operation might result in multiple SQL statements being executed, such as for joined-subclass. In the example of joined-subclass, a <code class="literal">DELETE</code> against one of the subclasses may actually result in deletes in the tables underlying the join, or further down the inheritance hierarchy.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id593574">3.4.2. HQL syntax for INSERT</h3></div></div></div><div class="example"><h6>Example 3.9. Pseudo-syntax for INSERT statements</h6><div class="example-contents"><pre class="screen">
          INSERT INTO EntityName <em class="replaceable"><code>properties_list</code></em> <em class="replaceable"><code>select_statement</code></em>
</pre></div></div><br class="example-break" /><div class="para">
				Only the <code class="literal">INSERT INTO ... SELECT ...</code> form is supported. You cannot specify explicit values to insert.
			</div><div class="para">
				The <em class="replaceable"><code>properties_list</code></em> is analogous to the column specification in the <code class="literal">SQL INSERT</code> statement. For entities involved in mapped inheritance, you can only use properties directly defined on that given class-level in the <em class="replaceable"><code>properties_list</code></em>. Superclass properties are not allowed and subclass properties are irrelevant. In other words, <code class="literal">INSERT</code> statements are inherently non-polymorphic.
			</div><div class="para">
				The <em class="replaceable"><code>select_statement</code></em> can be any valid HQL select query, but the return types must match the types expected by the INSERT. Hibernate verifies the return types during query compilation, instead of expecting the database to check it. Problems might result from Hibernate types which are equivalent, rather than equal. One such example is a mismatch between a property defined as an <span class="type">org.hibernate.type.DateType</span> and a property defined as an <span class="type">org.hibernate.type.TimestampType</span>, even though the database may not make a distinction, or may be capable of handling the conversion.
			</div><div class="para">
				If <em class="replaceable"><code>id</code></em> property is not specified in the <em class="replaceable"><code>properties_list</code></em>, Hibernate generates a value automatically. Automatic generation is only available if you use ID generators which operate on the database. Otherwise, Hibernate throws an exception during parsing. Available in-database generators are <code class="classname">org.hibernate.id.SequenceGenerator</code> and its subclasses, and objects which implement <code class="interfacename">org.hibernate.id.PostInsertIdentifierGenerator</code>. The most notable exception is <code class="classname">org.hibernate.id.TableHiLoGenerator</code>, which does not expose a selectable way to get its values.
			</div><div class="para">
				For properties mapped as either version or timestamp, the insert statement gives you two options. You can either specify the property in the properties_list, in which case its value is taken from the corresponding select expressions, or omit it from the properties_list, in which case the seed value defined by the org.hibernate.type.VersionType is used.
			</div><div class="example"><h6>Example 3.10. HQL INSERT statement</h6><div class="example-contents"><pre class="programlisting JAVA">Session session = sessionFactory.<span class="perl_Function">openSession</span>();
Transaction tx = session.<span class="perl_Function">beginTransaction</span>();

String hqlInsert = <span class="perl_String">"insert into DelinquentAccount (id, name) select c.id, c.name from Customer c where ..."</span>;
<span class="perl_DataType">int</span> createdEntities = s.<span class="perl_Function">createQuery</span>( hqlInsert )
        .<span class="perl_Function">executeUpdate</span>();
tx.<span class="perl_Function">commit</span>();
session.<span class="perl_Function">close</span>();</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id606598">3.4.3. More information on HQL</h3></div></div></div><div class="para">
				This section is only a brief overview of HQL. For more information, see <a class="xref" href="#chap-hql">Chapter 9, <i>HQL and JPAQL</i></a>.
			</div></div></div></div><div xml:lang="en-US" class="chapter" id="id629656" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 4. Locking</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#id722588">4.1. Optimistic</a></span></dt><dd><dl><dt><span class="section"><a href="#id677814">4.1.1. Dedicated version number</a></span></dt><dt><span class="section"><a href="#id618854">4.1.2. Timestamp</a></span></dt></dl></dd><dt><span class="section"><a href="#id630238">4.2. Pessimistic</a></span></dt><dd><dl><dt><span class="section"><a href="#id630258">4.2.1. The <code class="classname">LockMode</code> class</a></span></dt></dl></dd></dl></div><div class="para">
		Locking refers to actions taken to prevent data in a relational database from changing between the time it is read and the time that it is used.
	</div><div class="para">
		Your locking strategy can be either <em class="firstterm">optimistic</em> or <em class="firstterm">pessimistic</em>.
	</div><div class="variablelist"><h6>Locking strategies</h6><dl><dt class="varlistentry"><span class="term">Optimistic</span></dt><dd><div class="para">
					Optimistic locking ssumes that multiple transactions can complete without affecting each other, and that therefore transactions can proceed without locking the data resources that they affect. Before committing, each transaction verifies that no other transaction has modified its data. If the check reveals conflicting modifications, the committing transaction rolls back<sup>[<a id="id593038" href="#ftn.id593038" class="footnote">1</a>]</sup>.
				</div></dd><dt class="varlistentry"><span class="term">Pessimistic</span></dt><dd><div class="para">
					Pessimistic locking assumes that concurrent transactions will conflict with each other, and requires resources to be locked after they are read and only unlocked after the application has finished using the data.
				</div></dd></dl></div><div class="para">
		Hibernate provides mechanisms for implementing both types of locking in your applications.
	</div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id722588">4.1. Optimistic</h2></div></div></div><div class="para">
			When your application uses long transactions or conversations that span several database transactions, you can store versioning data, so that if the same entity is updated by two conversations, the last to commit changes is informed of the conflict, and does not override the other conversation's work. This approach guarantees some isolation, but scales well and works particularly well in <em class="firstterm">Read-Often Write-Sometimes</em> situations.
		</div><div class="para">
			Hibernate provides two different mechanisms for storing versioning information, a dedicated version number or a timestamp.
		</div><div class="variablelist"><dl><dt class="varlistentry"><span class="term">Version number</span></dt><dd><div class="para">

					</div></dd><dt class="varlistentry"><span class="term">Timestamp</span></dt><dd><div class="para">

					</div></dd></dl></div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				A version or timestamp property can never be null for a detached instance. Hibernate detects any instance with a null version or timestamp as transient, regardless of other unsaved-value strategies that you specify. Declaring a nullable version or timestamp property is an easy way to avoid problems with transitive reattachment in Hibernate, especially useful if you use assigned identifiers or composite keys.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id677814">4.1.1. Dedicated version number</h3></div></div></div><div class="para">
				The version number mechanism for optimistic locking is provided through a <code class="literal">@Version</code> annotation.
			</div><div class="example"><h6>Example 4.1. The @Version annotation</h6><div class="example-contents"><pre class="programlisting JAVA">@Entity
<span class="perl_Keyword">public</span> <span class="perl_Keyword">class</span> Flight <span class="perl_Keyword">implements</span> Serializable {
<span class="perl_Keyword">...</span>
<span class="perl_Keyword">    </span>@Version
    @<span class="perl_Function">Column</span>(name=<span class="perl_String">"OPTLOCK"</span>)
    <span class="perl_Keyword">public</span> Integer <span class="perl_Function">getVersion</span>() { <span class="perl_Keyword">... </span>}
}   </pre><div class="para">
					Here, the version property is mapped to the <code class="literal">OPTLOCK</code> column, and the entity manager uses it to detect conflicting updates, and prevent the loss of updates that would be overwritten by a <em class="firstterm">last-commit-wins</em> strategy.
				</div></div></div><br class="example-break" /><div class="para">
				The version column can be any kind of type, as long as you define and implement the appropriate <code class="classname">UserVersionType</code>.
			</div><div class="para">
				Your application is forbidden from altering the version number set by Hibernate. To artificially increase the version number, see the documentation for properties <span class="property">LockModeType.OPTIMISTIC_FORCE_INCREMENT</span> or <span class="property">LockModeType.PESSIMISTIC_FORCE_INCREMENTcheck</span> in the Hibernate Entity Manager reference documentation.
			</div><div class="note"><div class="admonition_header"><h2>Database-generated version numbers</h2></div><div class="admonition"><div class="para">
					If the version number is generated by the database, such as a trigger, use the annotation <code class="literal">@org.hibernate.annotations.Generated(GenerationTime.ALWAYS)</code>.
				</div></div></div><div class="example"><h6>Example 4.2. Declaring a version property in <code class="filename">hbm.xml</code></h6><div class="example-contents"><pre class="programlisting XML"><span class="perl_Keyword">&lt;version</span>
<span class="perl_Others">        column=</span><span class="perl_String">"version_column"</span>
<span class="perl_Others">        name=</span><span class="perl_String">"propertyName"</span>
<span class="perl_Others">        type=</span><span class="perl_String">"typename"</span>
<span class="perl_Others">        access=</span><span class="perl_String">"field|property|ClassName"</span>
<span class="perl_Others">        unsaved-value=</span><span class="perl_String">"null|negative|undefined"</span>
<span class="perl_Others">        generated=</span><span class="perl_String">"never|always"</span>
<span class="perl_Others">        insert=</span><span class="perl_String">"true|false"</span>
<span class="perl_Others">        node=</span><span class="perl_String">"element-name|@attribute-name|element/@attribute|."</span>
<span class="perl_Keyword">/&gt;</span></pre><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><tbody><tr><td>
									column
								</td><td>
									<div class="para">
										The name of the column holding the version number. Optional, defaults to the property name.
									</div>
								</td></tr><tr><td>
									name
								</td><td>
									<div class="para">
										The name of a property of the persistent class.
									</div>
								</td></tr><tr><td>
									type
								</td><td>
									<div class="para">
										The type of the version number. Optional, defaults to <code class="literal">integer</code>.
									</div>
								</td></tr><tr><td>
									access
								</td><td>
									<div class="para">
										Hibernate's strategy for accessing the property value. Optional, defaults to <code class="literal">property</code>.
									</div>
								</td></tr><tr><td>
									unsaved-value
								</td><td>
									<div class="para">
										Indicates that an instance is newly instantiated and thus unsaved. This distinguishes it from detached instances that were saved or loaded in a previous session. The default value, <code class="literal">undefined</code>, indicates that the identifier property value should be used. Optional.
									</div>
								</td></tr><tr><td>
									generated
								</td><td>
									<div class="para">
										Indicates that the version property value is generated by the database. Optional, defaults to <code class="literal">never</code>.
									</div>
								</td></tr><tr><td>
									insert
								</td><td>
									<div class="para">
										Whether or not to include the <code class="code">version</code> column in SQL <code class="code">insert</code> statements. Defaults to <code class="literal">true</code>, but you can set it to <code class="literal">false</code> if the database column is defined with a default value of <code class="literal">0</code>.
									</div>
								</td></tr></tbody></table></div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id618854">4.1.2. Timestamp</h3></div></div></div><div class="para">
				Timestamps are a less reliable way of optimistic locking than version numbers, but can be used by applications for other purposes as well. Timestamping is automatically used if you the <code class="code">@Version</code> annotation on a <span class="type">Date</span> or <span class="type">Calendar</span>.
			</div><div class="example"><h6>Example 4.3. Using timestamps for optimistic locking</h6><div class="example-contents"><pre class="programlisting JAVA">@Entity
<span class="perl_Keyword">public</span> <span class="perl_Keyword">class</span> Flight <span class="perl_Keyword">implements</span> Serializable {
<span class="perl_Keyword">...</span>
<span class="perl_Keyword">    </span>@Version
    <span class="perl_Keyword">public</span> Date <span class="perl_Function">getLastUpdate</span>() { <span class="perl_Keyword">... </span>}
} </pre></div></div><br class="example-break" /><div class="para">
				Hibernate can retrieve the timestamp value from the database or the JVM, by reading the value you specify for the <code class="code">@org.hibernate.annotations.Source</code> annotation. The value can be either <code class="literal">org.hibernate.annotations.SourceType.DB</code> or <code class="literal">org.hibernate.annotations.SourceType.VM</code>. The default behavior is to use the database, and is also used if you don't specify the annotation at all.
			</div><div class="para">
				The timestamp can also be generated by the database instead of Hibernate, if you use the <code class="code">@org.hibernate.annotations.Generated(GenerationTime.ALWAYS)</code> annotation.
			</div><div class="example"><h6>Example 4.4. The timestamp element in <code class="filename">hbm.xml</code></h6><div class="example-contents"><pre class="programlisting XML"><span class="perl_Keyword">&lt;timestamp</span>
<span class="perl_Others">        column=</span><span class="perl_String">"timestamp_column"</span>
<span class="perl_Others">        name=</span><span class="perl_String">"propertyName"</span>
<span class="perl_Others">        access=</span><span class="perl_String">"field|property|ClassName"</span>
<span class="perl_Others">        unsaved-value=</span><span class="perl_String">"null|undefined"</span>
<span class="perl_Others">        source=</span><span class="perl_String">"vm|db"</span>
<span class="perl_Others">        generated=</span><span class="perl_String">"never|always"</span>
<span class="perl_Others">        node=</span><span class="perl_String">"element-name|@attribute-name|element/@attribute|."</span>
<span class="perl_Keyword">/&gt;</span></pre><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><tbody><tr><td>
									column
								</td><td>
									<div class="para">
										The name of the column which holds the timestamp. Optional, defaults to the property namel
									</div>
								</td></tr><tr><td>
									name
								</td><td>
									<div class="para">
										The name of a JavaBeans style property of Java type Date or Timestamp of the persistent class.
									</div>
								</td></tr><tr><td>
									access
								</td><td>
									<div class="para">
										The strategy Hibernate uses to access the property value. Optional, defaults to <code class="literal">property</code>.
									</div>
								</td></tr><tr><td>
									unsaved-value
								</td><td>
									<div class="para">
										A version property which indicates than instance is newly instantiated, and unsaved. This distinguishes it from detached instances that were saved or loaded in a previous session. The default value of <code class="literal">undefined</code> indicates that Hibernate uses the identifier property value.
									</div>
								</td></tr><tr><td>
									source
								</td><td>
									<div class="para">
										Whether Hibernate retrieves the timestamp from the database or the current JVM. Database-based timestamps incur an overhead because Hibernate needs to query the database each time to determine the incremental next value. However, database-derived timestamps are safer to use in a clustered environment. Not all database dialects are known to support the retrieval of the database's current timestamp. Others may also be unsafe for locking, because of lack of precision.
									</div>
								</td></tr><tr><td>
									generated
								</td><td>
									<div class="para">
										Whether the timestamp property value is generated by the database. Optional, defaults to <code class="literal">never</code>.
									</div>
								</td></tr></tbody></table></div></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id630238">4.2. Pessimistic</h2></div></div></div><div class="para">
			Typically, you only need to specify an isolation level for the JDBC connections and let the database handle locking issues. If you do need to obtain exclusive pessimistic locks or re-obtain locks at the start of a new transaction, Hibernate gives you the tools you need.
		</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				Hibernate always uses the locking mechanism of the database, and never lock objects in memory.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id630258">4.2.1. The <code class="classname">LockMode</code> class</h3></div></div></div><div class="para">
				The <code class="classname">LockMode</code> class defines the different lock levels that Hibernate can acquire.
			</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><tbody><tr><td>
								LockMode.WRITE
							</td><td>
								<div class="para">
									acquired automatically when Hibernate updates or inserts a row.
								</div>
							</td></tr><tr><td>
								LockMode.UPGRADE
							</td><td>
								<div class="para">
									acquired upon explicit user request using <code class="code">SELECT ... FOR UPDATE</code> on databases which support that syntax.
								</div>
							</td></tr><tr><td>
								LockMode.UPGRADE_NOWAIT
							</td><td>
								<div class="para">
									acquired upon explicit user request using a <code class="code">SELECT ... FOR UPDATE NOWAIT</code> in Oracle.
								</div>
							</td></tr><tr><td>
								LockMode.READ
							</td><td>
								<div class="para">
									acquired automatically when Hibernate reads data under <span>Repeatable Read</span> or <span>Serializable</span> isolation level. It can be re-acquired by explicit user request.
								</div>
							</td></tr><tr><td>
								LockMode.NONE
							</td><td>
								<div class="para">
									The absence of a lock. All objects switch to this lock mode at the end of a Transaction. Objects associated with the session via a call to <code class="methodname">update()</code> or <code class="methodname">saveOrUpdate()</code> also start out in this lock mode.
								</div>
							</td></tr></tbody></table></div><div class="para">
				The explicit user request mentioned above occurs as a consequence of any of the following actions:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						A call to <code class="methodname">Session.load()</code>, specifying a LockMode.
					</div></li><li class="listitem"><div class="para">
						A call to <code class="methodname">Session.lock()</code>.
					</div></li><li class="listitem"><div class="para">
						A call to <code class="methodname">Query.setLockMode()</code>.
					</div></li></ul></div><div class="para">
				If you call <code class="methodname">Session.load()</code> with option <code class="option">UPGRADE</code> or <code class="option">UPGRADE_NOWAIT</code>, and the requested object is not already loaded by the session, the object is loaded using <code class="code">SELECT ... FOR UPDATE</code>. If you call <code class="methodname">load()</code> for an object that is already loaded with a less restrictive lock than the one you request, Hibernate calls <code class="methodname">lock()</code> for that object.
			</div><div class="para">
				<code class="methodname">Session.lock()</code> performs a version number check if the specified lock mode is <code class="literal">READ</code>, <code class="literal">UPGRADE</code>, or <code class="literal">UPGRADE_NOWAIT</code>. In the case of <code class="literal">UPGRADE</code> or <code class="literal">UPGRADE_NOWAIT</code>, <code class="code">SELECT ... FOR UPDATE</code> syntax is used.
			</div><div class="para">
				If the requested lock mode is not supported by the database, Hibernate uses an appropriate alternate mode instead of throwing an exception. This ensures that applications are portable.
			</div></div></div><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.id593038" href="#id593038" class="para">1</a>] </sup>
						<a href="http://en.wikipedia.org/wiki/Optimistic_locking">http://en.wikipedia.org/wiki/Optimistic_locking</a>
					</p></div></div></div><div xml:lang="en-US" class="chapter" id="id597010" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 5. Caching</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#id626068">5.1. The query cache</a></span></dt><dd><dl><dt><span class="section"><a href="#id625680">5.1.1. Query cache regions</a></span></dt></dl></dd><dt><span class="section"><a href="#id674763">5.2. Second-level cache providers</a></span></dt><dd><dl><dt><span class="section"><a href="#id674784">5.2.1. Configuring your cache providers</a></span></dt><dt><span class="section"><a href="#caching-strategies-list">5.2.2. Caching strategies</a></span></dt><dt><span class="section"><a href="#caching-provider-table">5.2.3. Second-level cache providers for Hibernate</a></span></dt></dl></dd><dt><span class="section"><a href="#id616840">5.3. Managing the cache</a></span></dt><dd><dl><dt><span class="section"><a href="#id616847">5.3.1. Moving items into and out of the cache</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id626068">5.1. The query cache</h2></div></div></div><div class="para">
			If you have queries that run over and over, with the same parameters, query caching provides performance gains.
		</div><div class="para">
			Caching introduces overhead in the area of transactional processing. For example, if you cache results of a query against an object, Hibernate needs to keep track of whether any changes have been committed against the object, and invalidate the cache accordingly. In addition, the benefit from caching query results is limited, and highly dependent on the usage patterns of your application. For these reasons, Hibernate disables the query cache by default.
		</div><div class="procedure"><h6>Procedure 5.1. Enabling the query cache</h6><ol class="1"><li class="step"><p class="title"><b>Set the <span class="property">hibernate.cache.use_query_cache</span> property to <code class="literal">true</code>.</b></p><div class="para">
					This setting creates two new cache regions:
				</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
							<code class="code">org.hibernate.cache.StandardQueryCache</code> holds the cached query results.
						</div></li><li class="listitem"><div class="para">
							<code class="code">org.hibernate.cache.UpdateTimestampsCache</code> holds timestamps of the most recent updates to queryable tables. These timestamps validate results served from the query cache.
						</div></li></ul></div></li><li class="step"><p class="title"><b>Adjust the cache timeout of the underlying cache region</b></p><div class="para">
					If you configure your underlying cache implementation to use expiry or timeouts, set the cache timeout of the underlying cache region for the <code class="code">UpdateTimestampsCache</code> to a higher value than the timeouts of any of the query caches. It is possible, and recommended, to set the UpdateTimestampsCache region never to expire. To be specific, a LRU (Least Recently Used) cache expiry policy is never appropriate.
				</div></li><li class="step"><p class="title"><b>Enable results caching for specific queries</b></p><div class="para">
					Since most queries do not benefit from caching of their results, you need to enable caching for individual queries, e ven after enabling query caching overall. To enable results caching for a particular query, call <code class="methodname">org.hibernate.Query.setCacheable(true)</code>. This call allows the query to look for existing cache results or add its results to the cache when it is executed.
				</div></li></ol></div><div class="para">
			The query cache does not cache the state of the actual entities in the cache. It caches identifier values and results of value type. Therefore, always use the query cache in conjunction with the second-level cache for those entities which should be cached as part of a query result cache.
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id625680">5.1.1. Query cache regions</h3></div></div></div><div class="para">
				For fine-grained control over query cache expiration policies, specify a named cache region for a particular query by calling <code class="methodname">Query.setCacheRegion()</code>.
			</div><div class="example"><h6>Example 5.1. Method <code class="methodname">setCacheRegion</code></h6><div class="example-contents"><pre class="programlisting JAVA">List blogs = sess.<span class="perl_Function">createQuery</span>(<span class="perl_String">"from Blog blog where blog.blogger = :blogger"</span>)
        .<span class="perl_Function">setEntity</span>(<span class="perl_String">"blogger"</span>, blogger)
        .<span class="perl_Function">setMaxResults</span>(<span class="perl_Float">15</span>)
        .<span class="perl_Function">setCacheable</span>(<span class="perl_Keyword">true</span>)
        .<span class="perl_Function">setCacheRegion</span>(<span class="perl_String">"frontpages"</span>)
        .<span class="perl_Function">list</span>();
</pre></div></div><br class="example-break" /><div class="para">
				To force the query cache to refresh one of its regions and disregard any cached results in the region, call <code class="code">org.hibernate.Query.setCacheMode(CacheMode.REFRESH)</code>. In conjunction with the region defined for the given query, Hibernate selectively refreshes the results cached in that particular region. This is much more efficient than bulk eviction of the region via <code class="code">org.hibernate.SessionFactory.evictQueries()</code>.
			</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id674763">5.2. Second-level cache providers</h2></div></div></div><div class="para">
			Hibernate is compatible with several second-level cache providers. None of the providers support all of Hibernate's possible caching strategies. <a class="xref" href="#caching-provider-table">Section 5.2.3, “Second-level cache providers for Hibernate”</a> lists the providers, along with their interfaces and supported caching strategies. For definitions of caching strategies, see <a class="xref" href="#caching-strategies-list">Section 5.2.2, “Caching strategies”</a>.
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id674784">5.2.1. Configuring your cache providers</h3></div></div></div><div class="para">
				You can configure your cache providers using either annotations or mapping files.
			</div><div class="formalpara"><h5 class="formalpara" id="id674794">Entities</h5>
					By default, entities are not part of the second-level cache, and their use is not recommended. If you absolutely must use entities, set the <code class="code">shared-cache-mode</code> element in <code class="filename">persistence.xml</code>, or use property <span class="property">javax.persistence.sharedCache.mode</span> in your configuration. Use one of the values in <a class="xref" href="#shared-cache-mode-values">Table 5.1, “Possible values for Shared Cache Mode”</a>.
				</div><div class="table" id="shared-cache-mode-values"><h6>Table 5.1. Possible values for Shared Cache Mode</h6><div class="table-contents"><table summary="Possible values for Shared Cache Mode" border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><thead><tr><th>
								Value
							</th><th>
								Description
							</th></tr></thead><tbody><tr><td>
								ENABLE_SELECTIVE
							</td><td>
								<div class="para">
									Entities are not cached unless you explicitly mark them as cachable. This is the default and recommended value.
								</div>

							</td></tr><tr><td>
								DISABLE_SELECTIVE
							</td><td>
								<div class="para">
									Entities are cached unless you explicitly mark them as not cacheable.
								</div>

							</td></tr><tr><td>
								ALL
							</td><td>
								<div class="para">
									All entities are always cached even if you mark them as not cacheable.
								</div>

							</td></tr><tr><td>
								NONE
							</td><td>
								<div class="para">
									No entities are cached even if you mark them as cacheable. This option basically disables second-level caching.
								</div>

							</td></tr></tbody></table></div></div><br class="table-break" /><div class="para">
				Set the global default cache concurrency strategy The cache concurrency strategy with the <span class="property">hibernate.cache.default_cache_concurrency_strategy</span> configuration property. See <a class="xref" href="#caching-strategies-list">Section 5.2.2, “Caching strategies”</a> for possible values.
			</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
					When possible, define the cache concurrency strategy per entity rather than globally. Use the <code class="code">@org.hibernate.annotations.Cache</code> annotation.
				</div></div></div><div class="example" id="configuring-cache-providers-annotations"><h6>Example 5.2. Configuring cache providers using annotations</h6><div class="example-contents"><pre class="programlisting JAVA">@Entity 
@Cacheable
@<span class="perl_Function">Cache</span>(usage = CacheConcurrencyStrategy.<span class="perl_Function">NONSTRICT_READ_WRITE</span>)
<span class="perl_Keyword">public</span> <span class="perl_Keyword">class</span> Forest { <span class="perl_Keyword">... </span>}</pre><div class="para">
					You can cache the content of a collection or the identifiers, if the collection contains other entities. Use the <code class="code">@Cache</code> annotation on the Collection property.
				</div><div class="para">
					<code class="code">@Cache</code> can take several attributes.
				</div><div class="variablelist"><h6>Attributes of <code class="code">@Cache</code> annotation</h6><dl><dt class="varlistentry"><span class="term">usage</span></dt><dd><div class="para">
								The given cache concurrency strategy, which may be:
							</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
										<code class="literal">NONE</code>
									</div></li><li class="listitem"><div class="para">
										<code class="literal">READ_ONLY</code>
									</div></li><li class="listitem"><div class="para">
										<code class="literal">NONSTRICT_READ_WRITE</code>
									</div></li><li class="listitem"><div class="para">
										<code class="literal">READ_WRITE</code>
									</div></li><li class="listitem"><div class="para">
										<code class="literal">TRANSACTIONAL</code>
									</div></li></ul></div></dd><dt class="varlistentry"><span class="term">region</span></dt><dd><div class="para">
								The cache region. This attribute is optional, and defaults to the fully-qualified class name of the class, or the qually-qualified role name of the collection.
							</div></dd><dt class="varlistentry"><span class="term">include</span></dt><dd><div class="para">
								Whether or not to include all properties.. Optional, and can take one of two possible values.
							</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
										A value of <code class="literal">all</code> includes all properties. This is the default.
									</div></li><li class="listitem"><div class="para">
										A value of <code class="literal">non-lazy</code> only includes non-lazy properties.
									</div></li></ul></div></dd></dl></div></div></div><br class="example-break" /><div class="example"><h6>Example 5.3. Configuring cache providers using mapping files</h6><div class="example-contents"><pre class="programlisting XML"><span class="perl_Keyword">&lt;cache</span>
<span class="perl_Others">    usage=</span><span class="perl_String">"transactional"</span>
<span class="perl_Others">    region=</span><span class="perl_String">"RegionName"</span>
<span class="perl_Others">    include=</span><span class="perl_String">"all"</span>
<span class="perl_Keyword">/&gt;</span></pre><div class="para">
					Just as in the <a class="xref" href="#configuring-cache-providers-annotations">Example 5.2, “Configuring cache providers using annotations”</a>, you can provide attributes in the mapping file. There are some specific differences in the syntax for the attributes in a mapping file.
				</div><div class="variablelist"><dl><dt class="varlistentry"><span class="term">usage</span></dt><dd><div class="para">
								The caching strategy. This attribute is required, and can be any of the following values.
							</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
										transactional
									</div></li><li class="listitem"><div class="para">
										read-write
									</div></li><li class="listitem"><div class="para">
										nonstrict-read-write
									</div></li><li class="listitem"><div class="para">
										read-only
									</div></li></ul></div></dd><dt class="varlistentry"><span class="term">region</span></dt><dd><div class="para">
								The name of the second-level cache region. This optional attribute defaults to the class or collection role name.
							</div></dd><dt class="varlistentry"><span class="term">include</span></dt><dd><div class="para">
								Whether properties of the entity mapped with <code class="literal">lazy=true</code> can be cached when attribute-level lazy fetching is enabled. Defaults to <code class="literal">all</code> and can also be <code class="literal">non-lazy</code>.
							</div></dd></dl></div><div class="para">
					Instead of <code class="code">&lt;cache&gt;</code>, you can use <code class="code">&lt;class-cache&gt;</code> and <code class="code">&lt;collection-cache&gt;</code> elements in <code class="filename">hibernate.cfg.xml</code>.
				</div></div></div><br class="example-break" /></div><div class="section" id="caching-strategies-list"><div class="titlepage"><div><div><h3 class="title" id="caching-strategies-list">5.2.2. Caching strategies</h3></div></div></div><div class="variablelist"><dl><dt class="varlistentry"><span class="term">read-only</span></dt><dd><div class="para">
							A read-only cache is good for data that needs to be read often but not modified. It is simple, performs well, and is safe to use in a clustered environment.
						</div></dd><dt class="varlistentry"><span class="term">nonstrict read-write</span></dt><dd><div class="para">
							Some applications only rarely need to modify data. This is the case if two transactions are unlikely to try to update the same item simultaneously. In this case, you do not need strict transaction isolation, and a nonstrict-read-write cache might be appropriate. If the cache is used in a JTA environment, you must specify <code class="classname">hibernate.transaction.manager_lookup_class</code>. In other environments, ensore that the transaction is complete before you call <code class="methodname">Session.close()</code> or <code class="methodname">Session.disconnect()</code>.
						</div></dd><dt class="varlistentry"><span class="term">read-write</span></dt><dd><div class="para">
							A read-write cache is appropriate for an application which needs to update data regularly. Do not use a read-write strategy if you need serializable transaction isolation. In a JTA environment, specify a strategy for obtaining the JTA TransactionManager by setting the property <span class="property">hibernate.transaction.manager_lookup_class</span>. In non-JTA environments, be sure the transaction is complete before you call <code class="methodname">Session.close()</code> or <code class="methodname">Session.disconnect()</code>.
						</div><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
								To use the read-write strategy in a clustered environment, the underlying cache implementation must support locking. The build-in cache providers do not support locking.
							</div></div></div></dd><dt class="varlistentry"><span class="term">transactional</span></dt><dd><div class="para">
							The transactional cache strategy provides support for transactional cache providers such as JBoss TreeCache. You can only use such a cache in a JTA environment, and you must first specify <code class="classname">hibernate.transaction.manager_lookup_class</code>.
						</div></dd></dl></div></div><div class="section" id="caching-provider-table"><div class="titlepage"><div><div><h3 class="title" id="caching-provider-table">5.2.3. Second-level cache providers for Hibernate</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col width="20%" /><col width="20%" /><col width="20%" /><col width="20%" /><col width="20%" /></colgroup><thead><tr><th>
								Cache
							</th><th>
								Interface
							</th><th>
								Supported strategies
							</th><td class="auto-generated"> </td><td class="auto-generated"> </td></tr></thead><tbody><tr><td>
								HashTable (testing only)
							</td><td>
							</td><td>
								<div class="itemizedlist"><ul><li class="listitem"><div class="para">
											read-only
										</div></li><li class="listitem"><div class="para">
											nontrict read-write
										</div></li><li class="listitem"><div class="para">
											read-write
										</div></li></ul></div>

							</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>
								EHCache
							</td><td>
							</td><td>
								<div class="itemizedlist"><ul><li class="listitem"><div class="para">
											read-only
										</div></li><li class="listitem"><div class="para">
											nontrict read-write
										</div></li><li class="listitem"><div class="para">
											read-write
										</div></li></ul></div>

							</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>
								OSCache
							</td><td>
							</td><td>
								<div class="itemizedlist"><ul><li class="listitem"><div class="para">
											read-only
										</div></li><li class="listitem"><div class="para">
											nontrict read-write
										</div></li><li class="listitem"><div class="para">
											read-write
										</div></li></ul></div>

							</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>
								SwarmCache
							</td><td>
							</td><td>
								<div class="itemizedlist"><ul><li class="listitem"><div class="para">
											read-only
										</div></li><li class="listitem"><div class="para">
											nontrict read-write
										</div></li></ul></div>

							</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>
								JBoss Cache 1.x
							</td><td>
							</td><td>
								<div class="itemizedlist"><ul><li class="listitem"><div class="para">
											read-only
										</div></li><li class="listitem"><div class="para">
											transactional
										</div></li></ul></div>

							</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td>
								JBoss Cache 2.x
							</td><td>
							</td><td>
								<div class="itemizedlist"><ul><li class="listitem"><div class="para">
											read-only
										</div></li><li class="listitem"><div class="para">
											transactional
										</div></li></ul></div>

							</td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr></tbody></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id616840">5.3. Managing the cache</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title" id="id616847">5.3.1. Moving items into and out of the cache</h3></div></div></div><div class="variablelist"><h6>Actions that add an item to internal cache of the Session</h6><dl><dt class="varlistentry"><span class="term">Saving or updating an item</span></dt><dd><div class="itemizedlist"><ul><li class="listitem"><div class="para">
									<code class="methodname">save()</code>
								</div></li><li class="listitem"><div class="para">
									<code class="methodname">update()</code>
								</div></li><li class="listitem"><div class="para">
									<code class="methodname">saveOrUpdate()</code>
								</div></li></ul></div></dd><dt class="varlistentry"><span class="term">Retrieving an item</span></dt><dd><div class="itemizedlist"><ul><li class="listitem"><div class="para">
									<code class="methodname">load()</code>
								</div></li><li class="listitem"><div class="para">
									<code class="methodname">get()</code>
								</div></li><li class="listitem"><div class="para">
									<code class="methodname">list()</code>
								</div></li><li class="listitem"><div class="para">
									<code class="methodname">iterate()</code>
								</div></li><li class="listitem"><div class="para">
									<code class="methodname">scroll()</code>
								</div></li></ul></div></dd></dl></div><div class="formalpara"><h5 class="formalpara" id="id616989">Syncing or removing a cached item</h5>
					The state of an object is synchronized with the database when you call method <code class="methodname">flush()</code>. To avoid this synchronization, you can remove the object and all collections from the first-level cache with the <code class="methodname">evict()</code> method. To remove all items from the Session cache, use method <code class="methodname">Session.clear()</code>.
				</div><div class="example"><h6>Example 5.4. Evicting an item from the first-level cache</h6><div class="example-contents"><pre class="programlisting JAVA">ScrollableResult cats = sess.<span class="perl_Function">createQuery</span>(<span class="perl_String">"from Cat as cat"</span>).<span class="perl_Function">scroll</span>(); <span class="perl_Comment">//a huge result set</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span><span class="perl_Keyword">while</span> ( cats.<span class="perl_Function">next</span>() ) {
    Cat cat = (Cat) cats.<span class="perl_Function">get</span>(<span class="perl_Float">0</span>);
    <span class="perl_Function">doSomethingWithACat</span>(cat);
    sess.<span class="perl_Function">evict</span>(cat);
}</pre></div></div><br class="example-break" /><div class="formalpara"><h5 class="formalpara" id="id617035">Determining whether an item belongs to the Session cache</h5>
					The Session provides a <code class="methodname">contains()</code> method to determine if an instance belongs to the session cache.
				</div><div class="example"><h6>Example 5.5. Second-level cache eviction</h6><div class="example-contents"><div class="para">
					You can evict the cached state of an instance, entire class, collection instance or entire collection role, using methods of <code class="classname">SessionFactory</code>.
				</div><pre class="programlisting JAVA">sessionFactory.<span class="perl_Function">evict</span>(Cat.<span class="perl_Function">class</span>, catId); <span class="perl_Comment">//evict a particular Cat</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>
sessionFactory.<span class="perl_Function">evict</span>(Cat.<span class="perl_Function">class</span>);  <span class="perl_Comment">//evict all Cats</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>
sessionFactory.<span class="perl_Function">evictCollection</span>(<span class="perl_String">"Cat.kittens"</span>, catId); <span class="perl_Comment">//evict a particular collection of kittens</span><span class="perl_Comment"></span>
<span class="perl_Comment"></span>
sessionFactory.<span class="perl_Function">evictCollection</span>(<span class="perl_String">"Cat.kittens"</span>); <span class="perl_Comment">//evict all kitten collections</span></pre></div></div><br class="example-break" /><div class="section"><div class="titlepage"><div><div><h4 class="title" id="id617083">5.3.1.1. Interactions between a Session and the second-level cache</h4></div></div></div><div class="para">
					The CacheMode controls how a particular session interacts with the second-level cache.
				</div><div class="informaltable"><table border="1"><colgroup><col width="50%" /><col width="50%" /></colgroup><tbody><tr><td>
									CacheMode.NORMAL
								</td><td>
									reads items from and writes them to the second-level cache.
								</td></tr><tr><td>
									CacheMode.GET
								</td><td>
									reads items from the second-level cache, but does not write to the second-level cache except to update data.
								</td></tr><tr><td>
									CacheMode.PUT
								</td><td>
									writes items to the second-level cache. It does not read from the second-level cache. It bypasses the effect of <span class="property">hibernate.cache.use_minimal_puts</span> and forces a refresh of the second-level cache for all items read from the database.
								</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title" id="id617149">5.3.1.2. Browsing the contents of a second-level or query cache region</h4></div></div></div><div class="para">
					After enabling statistics, you can browse the contents of a second-level cache or query cache region.
				</div><div class="procedure"><h6>Procedure 5.2. Enabling Statistics</h6><ol class="1"><li class="step"><div class="para">
							Set <code class="code">hibernate.generate_statistics</code> to <code class="literal">true</code>.
						</div></li><li class="step"><div class="para">
							Optionally, set <code class="code">hibernate.cache.use_structured_entries</code> to <code class="literal">true</code>, to cause Hibernate to store the cache entries in a human-readable format.
						</div></li></ol></div><div class="example"><h6>Example 5.6. Browsing the second-level cache entries via the Statistics API</h6><div class="example-contents"><pre class="programlisting JAVA">Map cacheEntries = sessionFactory.<span class="perl_Function">getStatistics</span>()
        .<span class="perl_Function">getSecondLevelCacheStatistics</span>(regionName)
        .<span class="perl_Function">getEntries</span>();</pre></div></div><br class="example-break" /></div></div></div></div><div xml:lang="en-US" class="chapter" id="id674235" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 6. Data categorizations</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#value-types">6.1. Value types</a></span></dt><dd><dl><dt><span class="section"><a href="#value-basic-types">6.1.1. Basic types</a></span></dt><dt><span class="section"><a href="#value-composite-types">6.1.2. Composite types</a></span></dt><dt><span class="section"><a href="#value-collection-types">6.1.3. Collection types</a></span></dt></dl></dd><dt><span class="section"><a href="#entity-types">6.2. Entity Types</a></span></dt><dt><span class="section"><a href="#id606315">6.3. Implications of different data categorizations</a></span></dt></dl></div><div class="para">
		Hibernate understands both the Java and JDBC representations of application data. The ability to read and write object data to a database is called <em class="firstterm">marshalling</em>, and is the function of a Hibernate <code class="classname">type</code>. A <code class="classname">type</code> is an implementation of the <code class="interfacename">org.hibernate.type.Type</code> interface. A Hibernate <code class="classname">type</code> describes various aspects of behavior of the Java type such as how to check for equality and how to clone values.
	</div><div class="note"><div class="admonition_header"><h2>Usage of the word <em class="wordasword">type</em></h2></div><div class="admonition"><div class="para">
			A Hibernate <code class="classname">type</code> is neither a Java type nor a SQL datatype. It provides information about both of these.
		</div><div class="para">
			When you encounter the term <em class="firstterm">type</em> in regards to Hibernate, it may refer to the Java type, the JDBC type, or the Hibernate type, depending on context.
		</div></div></div><div class="para">
		Hibernate categorizes types into two high-level groups: <a class="xref" href="#value-types">Section 6.1, “Value types”</a> and <a class="xref" href="#entity-types">Section 6.2, “Entity Types”</a>.
	</div><div class="section" id="value-types"><div class="titlepage"><div><div><h2 class="title" id="value-types">6.1. Value types</h2></div></div></div><div class="para">
			A <em class="firstterm">value type</em> does not define its own lifecycle. It is, in effect, owned by an <a class="xref" href="#entity-types">Section 6.2, “Entity Types”</a>, which defines its lifecycle. Value types are further classified into three sub-categories.
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					<a class="xref" href="#value-basic-types">Section 6.1.1, “Basic types”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="#value-composite-types">Section 6.1.2, “Composite types”</a>
				</div></li><li class="listitem"><div class="para">
					<a class="xref" href="#value-collection-types">Section 6.1.3, “Collection types”</a>
				</div></li></ul></div><div class="section" id="value-basic-types"><div class="titlepage"><div><div><h3 class="title" id="value-basic-types">6.1.1. Basic types</h3></div></div></div><div class="para">
				Basic value types usually map a single database value, or column, to a single, non-aggregated Java type. Hibernate provides a number of built-in basic types, which follow the natural mappings recommended in the JDBC specifications. You can override these mappings and provide and use alternative mappings. These topics are discussed further on.
			</div><div class="table"><h6>Table 6.1. Basic Type Mappings</h6><div class="table-contents"><table summary="Basic Type Mappings" border="1"><colgroup><col width="25%" /><col width="25%" /><col width="25%" /><col width="25%" /></colgroup><thead><tr><th>
								Hibernate type
							</th><th>
								Database type
							</th><th>
								JDBC type
							</th><th>
								Type registry
							</th></tr></thead><tbody><tr><td>
								org.hibernate.type.StringType
							</td><td>
								string
							</td><td>
								VARCHAR
							</td><td>
								string, java.lang.String
							</td></tr><tr><td>
								org.hibernate.type.MaterializedClob
							</td><td>
								string
							</td><td>
								CLOB
							</td><td>
								materialized_clob
							</td></tr><tr><td>
								org.hibernate.type.TextType
							</td><td>
								string
							</td><td>
								LONGVARCHAR
							</td><td>
								text
							</td></tr><tr><td>
								org.hibernate.type.CharacterType
							</td><td>
								char, java.lang.Character
							</td><td>
								CHAR
							</td><td>
								char, java.lang.Character
							</td></tr><tr><td>
								org.hibernate.type.BooleanType
							</td><td>
								boolean
							</td><td>
								BIT
							</td><td>
								boolean, java.lang.Boolean
							</td></tr><tr><td>
								org.hibernate.type.NumericBooleanType
							</td><td>
								boolean
							</td><td>
								INTEGER, 0 is false, 1 is true
							</td><td>
								numeric_boolean
							</td></tr><tr><td>
								org.hibernate.type.YesNoType
							</td><td>
								boolean
							</td><td>
								CHAR, 'N'/'n' is false, 'Y'/'y' is true. The uppercase value is written to the database.
							</td><td>
								yes_no
							</td></tr><tr><td>
								org.hibernate.type.TrueFalseType
							</td><td>
								boolean
							</td><td>
								CHAR, 'F'/'f' is false, 'T'/'t' is true. The uppercase value is written to the database.
							</td><td>
								true_false
							</td></tr><tr><td>
								org.hibernate.type.ByteType
							</td><td>
								byte, java.lang.Byte
							</td><td>
								TINYINT
							</td><td>
								byte, java.lang.Byte
							</td></tr><tr><td>
								org.hibernate.type.ShortType
							</td><td>
								short, java.lang.Short
							</td><td>
								SMALLINT
							</td><td>
								short, java.lang.Short
							</td></tr><tr><td>
								org.hibernate.type.IntegerTypes
							</td><td>
								int, java.lang.Integer
							</td><td>
								INTEGER
							</td><td>
								int, java.lang.Integer
							</td></tr><tr><td>
								org.hibernate.type.LongType
							</td><td>
								long, java.lang.Long
							</td><td>
								BIGINT
							</td><td>
								long, java.lang.Long
							</td></tr><tr><td>
								org.hibernate.type.FloatType
							</td><td>
								float, java.lang.Float
							</td><td>
								FLOAT
							</td><td>
								float, java.lang.Float
							</td></tr><tr><td>
								org.hibernate.type.DoubleType
							</td><td>
								double, java.lang.Double
							</td><td>
								DOUBLE
							</td><td>
								double, java.lang.Double
							</td></tr><tr><td>
								org.hibernate.type.BigIntegerType
							</td><td>
								java.math.BigInteger
							</td><td>
								NUMERIC
							</td><td>
								big_integer
							</td></tr><tr><td>
								org.hibernate.type.BigDecimalType
							</td><td>
								java.math.BigDecimal
							</td><td>
								NUMERIC
							</td><td>
								big_decimal, java.math.bigDecimal
							</td></tr><tr><td>
								org.hibernate.type.TimestampType
							</td><td>
								java.sql.Timestamp
							</td><td>
								TIMESTAMP
							</td><td>
								timestamp, java.sql.Timestamp
							</td></tr><tr><td>
								org.hibernate.type.TimeType
							</td><td>
								java.sql.Time
							</td><td>
								TIME
							</td><td>
								time, java.sql.Time
							</td></tr><tr><td>
								org.hibernate.type.DateType
							</td><td>
								java.sql.Date
							</td><td>
								DATE
							</td><td>
								date, java.sql.Date
							</td></tr><tr><td>
								org.hibernate.type.CalendarType
							</td><td>
								java.util.Calendar
							</td><td>
								TIMESTAMP
							</td><td>
								calendar, java.util.Calendar
							</td></tr><tr><td>
								org.hibernate.type.CalendarDateType
							</td><td>
								java.util.Calendar
							</td><td>
								DATE
							</td><td>
								calendar_date
							</td></tr><tr><td>
								org.hibernate.type.CurrencyType
							</td><td>
								java.util.Currency
							</td><td>
								VARCHAR
							</td><td>
								currency, java.util.Currency
							</td></tr><tr><td>
								org.hibernate.type.LocaleType
							</td><td>
								java.util.Locale
							</td><td>
								VARCHAR
							</td><td>
								locale, java.utility.locale
							</td></tr><tr><td>
								org.hibernate.type.TimeZoneType
							</td><td>
								java.util.TimeZone
							</td><td>
								VARCHAR, using the TimeZone ID
							</td><td>
								timezone, java.util.TimeZone
							</td></tr><tr><td>
								org.hibernate.type.UrlType
							</td><td>
								java.net.URL
							</td><td>
								VARCHAR
							</td><td>
								url, java.net.URL
							</td></tr><tr><td>
								org.hibernate.type.ClassType
							</td><td>
								java.lang.Class
							</td><td>
								VARCHAR, using the class name
							</td><td>
								class, java.lang.Class
							</td></tr><tr><td>
								org.hibernate.type.BlobType
							</td><td>
								java.sql.Blob
							</td><td>
								BLOB
							</td><td>
								blog, java.sql.Blob
							</td></tr><tr><td>
								org.hibernate.type.ClobType
							</td><td>
								java.sql.Clob
							</td><td>
								CLOB
							</td><td>
								clob, java.sql.Clob
							</td></tr><tr><td>
								org.hibernate.type.BinaryType
							</td><td>
								primitive byte[]
							</td><td>
								VARBINARY
							</td><td>
								binary, byte[]
							</td></tr><tr><td>
								org.hibernate.type.MaterializedBlobType
							</td><td>
								primitive byte[]
							</td><td>
								BLOB
							</td><td>
								materized_blob
							</td></tr><tr><td>
								org.hibernate.type.ImageType
							</td><td>
								primitive byte[]
							</td><td>
								LONGVARBINARY
							</td><td>
								image
							</td></tr><tr><td>
								org.hibernate.type.BinaryType
							</td><td>
								java.lang.Byte[]
							</td><td>
								VARBINARY
							</td><td>
								wrapper-binary
							</td></tr><tr><td>
								org.hibernate.type.CharArrayType
							</td><td>
								char[]
							</td><td>
								VARCHAR
							</td><td>
								characters, char[]
							</td></tr><tr><td>
								org.hibernate.type.CharacterArrayType
							</td><td>
								java.lang.Character[]
							</td><td>
								VARCHAR
							</td><td>
								wrapper-characters, Character[], java.lang.Character[]
							</td></tr><tr><td>
								org.hibernate.type.UUIDBinaryType
							</td><td>
								java.util.UUID
							</td><td>
								BINARY
							</td><td>
								uuid-binary, java.util.UUID
							</td></tr><tr><td>
								org.hibernate.type.UUIDCharType
							</td><td>
								java.util.UUID
							</td><td>
								CHAR, can also read VARCHAR
							</td><td>
								uuid-char
							</td></tr><tr><td>
								org.hibernate.type.PostgresUUIDType
							</td><td>
								java.util.UUID
							</td><td>
								PostgreSQL UUID, through Types#OTHER, which complies to the PostgreSQL JDBC driver definition
							</td><td>
								pg-uuid
							</td></tr><tr><td>
								org.hibernate.type.SerializableType
							</td><td>
								implementors of java.lang.Serializable
							</td><td>
								VARBINARY
							</td><td>
								Unlike the other value types, multiple instances of this type are registered. It is registered once under java.io.Serializable, and registered under the specific java.io.Serializable implementation class names.
							</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section" id="value-composite-types"><div class="titlepage"><div><div><h3 class="title" id="value-composite-types">6.1.2. Composite types</h3></div></div></div><div class="para">
				<em class="firstterm">Composite types</em>, or <em class="firstterm">embedded types</em>, as they are called by the Java Persistence API, have traditionally been called <em class="firstterm">components</em> in Hibernate. All of these terms mean the same thing.
			</div><div class="para">
				Components represent aggregations of values into a single Java type. An example is an <code class="classname">Address</code> class, which aggregates street, city, state, and postal code. A composite type behaves in a similar way to an entity. They are each classes written specifically for an application. They may both include references to other application-specific classes, as well as to collections and simple JDK types. The only distinguishing factors are that a component does not have its own lifecycle or define an identifier.
			</div></div><div class="section" id="value-collection-types"><div class="titlepage"><div><div><h3 class="title" id="value-collection-types">6.1.3. Collection types</h3></div></div></div><div class="para">
				A <em class="firstterm">collection</em> type refers to the data type itself, not its contents.
			</div><div class="para">
				A Collection denotes a one-to-one or one-to-many relationship between tables of a database.
			</div><div class="para">
				Refer to the chapter on Collections for more information on collections.
			</div></div></div><div class="section" id="entity-types"><div class="titlepage"><div><div><h2 class="title" id="entity-types">6.2. Entity Types</h2></div></div></div><div class="para">
			Entities are application-specific classes which correlate to rows in a table, using a unique identifier. Because of the requirement for a unique identifier, ntities exist independently and define their own lifecycle. As an example, deleting a Membership should not delete the User or the Group. For more information, see the chapter on Persistent Classes.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id606315">6.3. Implications of different data categorizations</h2></div></div></div><div class="para">
			NEEDS TO BE WRITTEN
		</div></div></div><div xml:lang="en-US" class="chapter" id="id555220" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 7. Mapping entities</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#id670714">7.1. Hierarchies</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id670714">7.1. Hierarchies</h2></div></div></div><div class="para">

		</div></div></div><div xml:lang="en-US" class="chapter" id="id702195" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 8. Mapping associations</h2></div></div></div><div class="para">

	</div></div><div xml:lang="en-US" class="chapter" id="chap-hql" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 9. HQL and JPAQL</h2></div></div></div><div class="para">

	</div></div><div xml:lang="en-US" class="chapter" id="id698504" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 10. Criteria</h2></div></div></div><div class="para">

	</div></div><div xml:lang="en-US" class="chapter" id="id658424" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 11. Native-SQL</h2></div></div></div><div class="para">

	</div></div><div xml:lang="en-US" class="chapter" id="id698643" lang="en-US"><div class="titlepage"><div><div><h2 class="title">Chapter 12. JMX</h2></div></div></div><div class="para">

	</div></div><div xml:lang="en-US" class="appendix" id="appendix-Configuration_Properties" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Configuration properties</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id702970">A.1. General Configuration</h2></div></div></div><div class="informaltable"><table border="1"><colgroup><col width="100px" /><col width="120px" /><col width="250px" /></colgroup><tbody><tr><td>
							hibernate.dialect
						</td><td>
							A fully-qualified classname
						</td><td>
							<div class="para">
								The classname of a Hibernate <code class="classname">org.hibernate.dialect.Dialect</code> from which Hibernate can generate SQL optimized for a particular relational database.
							</div>
							 <div class="para">
								In most cases Hibernate can choose the correct <code class="classname">org.hibernate.dialect.Dialect</code> implementation based on the JDBC metadata returned by the JDBC driver.
							</div>

						</td></tr><tr><td>
							hibernate.show_sql
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Write all SQL statements to the console. This is an alternative to setting the log category <span class="property">org.hibernate.SQL</span> to debug.
						</td></tr><tr><td>
							hibernate.format_sql
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Pretty-print the SQL in the log and console.
						</td></tr><tr><td>
							hibernate.default_schema
						</td><td>
							A schema name
						</td><td>
							Qualify unqualified table names with the given schema or tablespace in generated SQL.
						</td></tr><tr><td>
							hibernate.default_catalog
						</td><td>
							A catalog name
						</td><td>
							Qualifies unqualified table names with the given catalog in generated SQL.
						</td></tr><tr><td>
							hibernate.session_factory_name
						</td><td>
							A JNDI name
						</td><td>
							The <code class="classname">org.hibernate.SessionFactory</code> is automatically bound to this name in JNDI after it is created.
						</td></tr><tr><td>
							hibernate.max_fetch_depth
						</td><td>
							A value between <code class="literal">0</code> and <code class="literal">3</code>
						</td><td>
							Sets a maximum depth for the outer join fetch tree for single-ended associations. A single-ended assocation is a one-to-one or many-to-one assocation. A value of <code class="literal">0</code> disables default outer join fetching.
						</td></tr><tr><td>
							hibernate.default_batch_fetch_size
						</td><td>
							<div class="para">
								<code class="literal">4</code>,<code class="literal">8</code>, or <code class="literal">16</code>
							</div>
						</td><td>
							Default size for Hibernate batch fetching of associations.
						</td></tr><tr><td>
							hibernate.default_entity_mode
						</td><td>
							<div class="para">
								One of <code class="literal">dynamic-map</code>, <code class="literal">dom4j</code>, <code class="literal">pojo</code>
							</div>
						</td><td>
							Default mode for entity representation for all sessions opened from this <code class="classname">SessionFactory</code>
						</td></tr><tr><td>
							hibernate.order_updates
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Forces Hibernate to order SQL updates by the primary key value of the items being updated. This reduces the likelihood of transaction deadlocks in highly-concurrent systems.
						</td></tr><tr><td>
							hibernate.generate_statistics
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Causes Hibernate to collect statistics for performance tuning.
						</td></tr><tr><td>
							hibernate.use_identifier_rollback
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							If true, generated identifier properties are reset to default values when objects are deleted.
						</td></tr><tr><td>
							hibernate.use_sql_comments
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							If true, Hibernate generates comments inside the SQL, for easier debugging.
						</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id697542">A.2. Database configuration</h2></div></div></div><div class="table"><h6>Table A.1. JDBC properties</h6><div class="table-contents"><table summary="JDBC properties" border="1"><colgroup><col width="33%" /><col width="33%" /><col width="33%" /></colgroup><thead><tr><th>
							Property
						</th><th>
							Example
						</th><th>
							Purpose
						</th></tr></thead><tbody><tr><td>
							hibernate.jdbc.fetch_size
						</td><td>
							<code class="literal">0</code> or an integer
						</td><td>
							A non-zero value determines the JDBC fetch size, by calling <code class="methodname">Statement.setFetchSize()</code>.
						</td></tr><tr><td>
							hibernate.jdbc.batch_size
						</td><td>
							<div class="para">
								A value between <code class="literal">5</code> and <code class="literal">30</code>
							</div>
						</td><td>
							A non-zero value causes Hibernate to use JDBC2 batch updates.
						</td></tr><tr><td>
							hibernate.jdbc.batch_versioned_data
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							<div class="para">
								Set this property to <code class="literal">true</code> if your JDBC driver returns correct row counts from <code class="methodname">executeBatch()</code>. This option is usually safe, but is disabled by default. If enabled, Hibernate uses batched DML for automatically versioned data.
							</div>
						</td></tr><tr><td>
							hibernate.jdbc.factory_class
						</td><td>
							The fully-qualified class name of the factory
						</td><td>
							<div class="para">
								Select a custom <code class="classname">org.hibernate.jdbc.Batcher</code>. Irrelevant for most applications.
							</div>
						</td></tr><tr><td>
							hibernate.jdbc.use_scrollable_resultset
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Enables Hibernate to use JDBC2 scrollable resultsets. This property is only relevant for user-supplied JDBC connections. Otherwise, Hibernate uses connection metadata.
						</td></tr><tr><td>
							hibernate.jdbc.use_streams_for_binary
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							<div class="para">
								Use streams when writing or reading <span class="type">binary</span> or <span class="type">serializable</span> types to or from JDBC. This is a system-level property.
							</div>
						</td></tr><tr><td>
							hibernate.jdbc.use_get_generated_keys
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							<div class="para">
								Allows Hibernate to use JDBC3 <code class="classname">PreparedStatement.getGeneratedKeys()</code> to retrieve natively-generated keys after insert. You need the JDBC3+ driver and JRE1.4+. Disable this property if your driver has problems with the Hibernate identifier generators. By default, it tries to detect the driver capabilities from connection metadata.
							</div>
						</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><h6>Table A.2. Cache Properties</h6><div class="table-contents"><table summary="Cache Properties" border="1"><colgroup><col width="100px" /><col width="100px" /><col width="240px" /></colgroup><thead><tr><th>
							Property
						</th><th>
							Example
						</th><th>
							Purpose
						</th></tr></thead><tbody><tr><td>
							hibernate.cache.provider_class
						</td><td>
							Fully-qualified classname
						</td><td>
							The classname of a custom CacheProvider.
						</td></tr><tr><td>
							hibernate.cache.use_minimal_puts
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Optimizes second-level cache operation to minimize writes, at the cost of more frequent reads. This is most useful for clustered caches and is enabled by default for clustered cache implementations.
						</td></tr><tr><td>
							hibernate.cache.use_query_cache
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Enables the query cache. You still need to set individual queries to be cachable.
						</td></tr><tr><td>
							hibernate.cache.use_second_level_cache
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Completely disable the second level cache, which is enabled by default for classes which specify a &lt;cache&gt; mapping.
						</td></tr><tr><td>
							hibernate.cache.query_cache_factory
						</td><td>
							Fully-qualified classname
						</td><td>
							A custom <code class="interfacename">QueryCache</code> interface. The default is the built-in <code class="interfacename">StandardQueryCache</code>.
						</td></tr><tr><td>
							hibernate.cache.region_prefix
						</td><td>
							A string
						</td><td>
							A prefix for second-level cache region names.
						</td></tr><tr><td>
							hibernate.cache.use_structured_entries
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Forces Hibernate to store data in the second-level cache in a more human-readable format.
						</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><h6>Table A.3. Transactions properties</h6><div class="table-contents"><table summary="Transactions properties" border="1"><colgroup><col width="100px" /><col width="100px" /><col width="240px" /></colgroup><thead><tr><th>
							Property
						</th><th>
							Example
						</th><th>
							Purpose
						</th></tr></thead><tbody><tr><td>
							hibernate.transaction.factory_class
						</td><td>
							A fully-qualified classname
						</td><td>
							The classname of a <code class="classname">TransactionFactory</code> to use with Hibernate Transaction API. The default is <code class="classname">JDBCTransactionFactory</code>).
						</td></tr><tr><td>
							jta.UserTransaction
						</td><td>
							A JNDI name
						</td><td>
							<div class="para">
								The <code class="classname">JTATransactionFactory</code> needs a JNDI name to obtain the JTA UserTransaction from the application server.
							</div>
						</td></tr><tr><td>
							hibernate.transaction.manager_lookup_class
						</td><td>
							A fully-qualified classname
						</td><td>
							<div class="para">
								The classname of a <code class="classname">TransactionManagerLookup</code>, which is used in conjunction with JVM-level or the hilo generator in a JTA environment.
							</div>
						</td></tr><tr><td>
							hibernate.transaction.flush_before_completion
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Causes the session be flushed during the <span>before completion</span> phase of the transaction. If possible, use built-in and automatic session context management instead.
						</td></tr><tr><td>
							hibernate.transaction.auto_close_session
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							Causes the session to be closed during the <span>after completion</span> phase of the transaction. If possible, use built-in and automatic session context management instead.
						</td></tr></tbody></table></div></div><br class="table-break" /><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				Each of the properties in the following table are prefixed by <code class="literal">hibernate.</code>. It has been removed in the table to conserve space.
			</div></div></div><div class="table"><h6>Table A.4. Miscellaneous properties</h6><div class="table-contents"><table summary="Miscellaneous properties" border="1"><colgroup><col width="33%" /><col width="33%" /><col width="33%" /></colgroup><thead><tr><th>
							Property
						</th><th>
							Example
						</th><th>
							Purpose
						</th></tr></thead><tbody><tr><td>
							current_session_context_class
						</td><td>
							<div class="para">
								One of <code class="literal">jta</code>, <code class="literal">thread</code>, <code class="literal">managed</code>, or <code class="literal">custom.Class</code>
							</div>
						</td><td>
							<div class="para">
								Supply a custom strategy for the scoping of the <code class="classname">Current</code> Session.
							</div>
						</td></tr><tr><td>
							factory_class
						</td><td>
							<div class="para">
								<code class="literal">org.hibernate.hql.ast.ASTQueryTranslatorFactory</code> or <code class="literal">org.hibernate.hql.classic.ClassicQueryTranslatorFactory</code>
							</div>
						</td><td>
							Chooses the HQL parser implementation.
						</td></tr><tr><td>
							query.substitutions
						</td><td>
							<div class="para">
								<code class="literal">hqlLiteral=SQL_LITERAL</code> or <code class="literal">hqlFunction=SQLFUNC</code>
							</div>
						</td><td>
							Map from tokens in Hibernate queries to SQL tokens, such as function or literal names.
						</td></tr><tr><td>
							hbm2ddl.auto
						</td><td>
							<div class="para">
								<code class="literal">validate</code>, <code class="literal">update</code>, <code class="literal">create</code>, <code class="literal">create-drop</code>
							</div>
						</td><td>
							Validates or exports schema DDL to the database when the <code class="classname">SessionFactory</code> is created. With <code class="command">create-drop</code>, the database schema is dropped when the <code class="classname">SessionFactory</code> is closed explicitly.
						</td></tr><tr><td>
							cglib.use_reflection_optimizer
						</td><td>
							<div class="para">
								<code class="literal">true</code> or <code class="literal">false</code>
							</div>
						</td><td>
							If enabled, Hibernate uses CGLIB instead of runtime reflection. This is a system-level property. Reflection is useful for troubleshooting. Hibernate always requires CGLIB even if you disable the optimizer. You cannot set this property in hibernate.cfg.xml.
						</td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" id="id624351">A.3. Connection pool properties</h2></div></div></div><div class="itemizedlist"><h6>c3p0 connection pool properties</h6><ul><li class="listitem"><div class="para">
					hibernate.c3p0.min_size
				</div></li><li class="listitem"><div class="para">
					hibernate.c3p0.max_size
				</div></li><li class="listitem"><div class="para">
					hibernate.c3p0.timeout
				</div></li><li class="listitem"><div class="para">
					hibernate.c3p0.max_statements
				</div></li></ul></div><div class="table"><h6>Table A.5. Proxool connection pool properties</h6><div class="table-contents"><table summary="Proxool connection pool properties" border="1"><colgroup><col width="100px" /><col width="340px" /></colgroup><thead><tr><th>
							Property
						</th><th>
							Description
						</th></tr></thead><tbody><tr><td>
							hibernate.proxool.xml
						</td><td>
							Configure Proxool provider using an XML file (.xml is appended automatically)
						</td></tr><tr><td>
							hibernate.proxool.properties
						</td><td>
							Configure the Proxool provider using a properties file (.properties is appended automatically)
						</td></tr><tr><td>
							hibernate.proxool.existing_pool
						</td><td>
							Whether to configure the Proxool provider from an existing pool
						</td></tr><tr><td>
							hibernate.proxool.pool_alias
						</td><td>
							Proxool pool alias to use. Required.
						</td></tr></tbody></table></div></div><br class="table-break" /><div class="note"><div class="admonition_header"><h2>Note</h2></div><div class="admonition"><div class="para">
				For information on specific configuration of Proxool, refer to the Proxool documentation available from <a href="http://proxool.sourceforge.net/">http://proxool.sourceforge.net/</a>.
			</div></div></div></div></div><div xml:lang="en-US" class="appendix" id="appe-Hibernate_Development_Guide-Revision_History" lang="en-US"><div class="titlepage"><div><div><h1 class="title">Revision History</h1></div></div></div><div class="para">
		<div class="revhistory"><table border="0" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 0-0</td><td align="left">Mon Jan 17 2011</td><td align="left"><span class="author"><span class="firstname">Dude</span> <span class="surname">McPants</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Initial creation of book by publican</td></tr></table>

				</td></tr></table></div>

	</div></div><div class="index" id="id548714"><div class="titlepage"><div><div><h2 class="title">Index</h2></div></div></div><div class="index"><div class="indexdiv"><h3>F</h3><dl><dt>feedback</dt><dd><dl><dt>contact information for this manual, <a class="indexterm" href="#id608557">We Need Feedback!</a></dt></dl></dd></dl></div></div></div></div></body></html>
